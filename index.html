<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ú–æ—Ä—Å–∫–æ–π –ë–æ–π - –ü–æ–ª–Ω–∞—è –≤–µ—Ä—Å–∏—è</title>
    <style>
        :root {
            --primary: #1a237e;
            --secondary: #283593;
            --accent: #536dfe;
            --neon-blue: #00b0ff;
            --neon-red: #ff1744;
            --neon-green: #00e676;
            --neon-yellow: #ffeb3b;
            --neon-purple: #e040fb;
            --text: #e8eaf6;
            --grid-bg: #0d47a1;
            --cell-size: 35px;
            --ai-easy: #4CAF50;
            --ai-medium: #FF9800;
            --ai-hard: #F44336;
            --lobby-bg: #0d1b36;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #0c2461, #1e3799);
            color: var(--text);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .hidden {
            display: none !important;
        }

        /* –ó–∞–≥–æ–ª–æ–≤–æ–∫ */
        .header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 15px;
            border: 2px solid var(--neon-blue);
            box-shadow: 0 0 20px rgba(0, 176, 255, 0.3);
        }

        h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            color: var(--neon-blue);
            text-shadow: 0 0 10px rgba(0, 176, 255, 0.5);
        }

        /* –ú–µ–Ω—é –≤—ã–±–æ—Ä–∞ —Ä–µ–∂–∏–º–∞ */
        .mode-selection {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin: 30px 0;
            flex-wrap: wrap;
        }

        .mode-card {
            background: linear-gradient(145deg, var(--secondary), var(--primary));
            border: 2px solid var(--neon-blue);
            border-radius: 15px;
            padding: 30px;
            width: 300px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.3);
        }

        .mode-card:hover {
            transform: translateY(-5px);
            border-color: var(--neon-green);
            box-shadow: 0 15px 30px rgba(0, 176, 255, 0.4);
        }

        .mode-icon {
            font-size: 48px;
            margin-bottom: 15px;
        }

        .mode-title {
            font-size: 24px;
            color: var(--neon-green);
            margin-bottom: 10px;
        }

        /* –ú–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞ */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .modal {
            background: linear-gradient(145deg, var(--lobby-bg), var(--primary));
            border: 2px solid var(--neon-blue);
            border-radius: 15px;
            padding: 30px;
            width: 90%;
            max-width: 500px;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--neon-blue);
        }

        .modal-title {
            font-size: 24px;
            color: var(--neon-green);
        }

        .close-btn {
            background: none;
            border: none;
            color: var(--neon-red);
            font-size: 24px;
            cursor: pointer;
        }

        /* –§–æ—Ä–º—ã */
        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            color: var(--neon-yellow);
            font-weight: bold;
        }

        .form-input {
            width: 100%;
            padding: 12px 15px;
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid var(--accent);
            border-radius: 8px;
            color: white;
            font-size: 16px;
        }

        .form-input:focus {
            outline: none;
            border-color: var(--neon-blue);
        }

        /* –ö–Ω–æ–ø–∫–∏ */
        .btn {
            background: linear-gradient(45deg, var(--accent), var(--neon-blue));
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            margin: 5px;
            min-width: 150px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(83, 109, 254, 0.4);
        }

        .btn:disabled {
            background: #666;
            cursor: not-allowed;
        }

        .btn-success {
            background: linear-gradient(45deg, var(--neon-green), #00c853);
        }

        .btn-danger {
            background: linear-gradient(45deg, var(--neon-red), #D50000);
        }

        /* –≠–∫—Ä–∞–Ω –∏–≥—Ä—ã */
        .game-screen {
            background: rgba(13, 71, 161, 0.9);
            padding: 25px;
            border-radius: 15px;
            border: 2px solid var(--accent);
            margin-top: 20px;
        }

        .game-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding: 15px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 10px;
            border: 1px solid var(--neon-blue);
        }

        .info-item {
            text-align: center;
        }

        .info-label {
            font-size: 14px;
            color: var(--neon-green);
            margin-bottom: 5px;
        }

        .info-value {
            font-size: 24px;
            font-weight: bold;
            color: var(--neon-yellow);
        }

        /* –ò–≥—Ä–æ–≤—ã–µ –ø–æ–ª—è */
        .game-area {
            display: flex;
            justify-content: space-around;
            flex-wrap: wrap;
            gap: 30px;
            margin-bottom: 20px;
        }

        .grid-container {
            text-align: center;
            background: rgba(0, 0, 0, 0.2);
            padding: 15px;
            border-radius: 10px;
            border: 1px solid var(--accent);
        }

        .grid-title {
            margin-bottom: 15px;
            font-size: 1.3em;
            color: var(--neon-green);
            padding: 10px;
            border-bottom: 2px solid var(--neon-blue);
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(10, var(--cell-size));
            grid-template-rows: repeat(10, var(--cell-size));
            gap: 2px;
            background: rgba(0, 0, 0, 0.3);
            padding: 10px;
            border-radius: 8px;
            border: 2px solid var(--accent);
        }

        .cell {
            width: var(--cell-size);
            height: var(--cell-size);
            background: rgba(255, 255, 255, 0.1);
            border-radius: 3px;
            cursor: pointer;
            transition: all 0.2s;
            position: relative;
        }

        .cell:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .cell.ship {
            background: linear-gradient(45deg, #4CAF50, #8BC34A);
            border: 1px solid #388E3C;
        }

        .cell.hit {
            background: linear-gradient(45deg, #F44336, #E53935);
        }

        .cell.hit::after {
            content: '‚úï';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: white;
            font-size: 20px;
            font-weight: bold;
        }

        .cell.miss {
            background: rgba(33, 150, 243, 0.3);
        }

        .cell.miss::after {
            content: '‚Ä¢';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: #2196F3;
            font-size: 24px;
        }

        .cell.preview {
            background: rgba(76, 175, 80, 0.5);
            border: 1px dashed #4CAF50;
        }

        /* –°—Ç–∞—Ç—É—Å –∏–≥—Ä—ã */
        .status {
            text-align: center;
            padding: 15px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            border: 1px solid var(--neon-blue);
            margin-top: 20px;
            min-height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2em;
            font-weight: bold;
        }

        /* –í–µ—Ä—Ñ—å –∫–æ—Ä–∞–±–ª–µ–π */
        .ship-factory {
            background: rgba(0, 0, 0, 0.2);
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            border: 2px solid var(--neon-blue);
        }

        .ship-types {
            display: flex;
            gap: 15px;
            justify-content: center;
            flex-wrap: wrap;
            margin: 15px 0;
        }

        .ship-type-btn {
            padding: 10px 20px;
            border: 2px solid var(--accent);
            background: rgba(0, 0, 0, 0.3);
            color: var(--text);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .ship-type-btn:hover {
            background: rgba(83, 109, 254, 0.2);
        }

        .ship-type-btn.active {
            background: var(--accent);
            border-color: var(--neon-blue);
        }

        /* –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 20px;
            background: var(--lobby-bg);
            border-left: 4px solid var(--neon-blue);
            border-radius: 5px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            z-index: 1001;
        }

        .notification-success {
            border-left-color: var(--neon-green);
        }

        .notification-error {
            border-left-color: var(--neon-red);
        }

        @media (max-width: 768px) {
            .game-area {
                flex-direction: column;
                align-items: center;
            }
            
            .grid {
                grid-template-columns: repeat(10, 30px);
                grid-template-rows: repeat(10, 30px);
            }
            
            .cell {
                width: 30px;
                height: 30px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ -->
        <div class="header">
            <h1>‚öì –ú–æ—Ä—Å–∫–æ–π –ë–æ–π</h1>
            <p>–°—Ä–∞–∑–∏—Ç–µ—Å—å —Å –ò–ò –∏–ª–∏ –∏–≥—Ä–∞–π—Ç–µ —Å –¥—Ä—É–∑—å—è–º–∏ –æ–Ω–ª–∞–π–Ω!</p>
        </div>

        <!-- –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é -->
        <div id="main-menu" class="mode-selection">
            <div class="mode-card" onclick="selectGameMode('ai')">
                <div class="mode-icon">ü§ñ</div>
                <div class="mode-title">–ò–≥—Ä–∞ —Å –ò–ò</div>
                <p>–°—Ä–∞–∑–∏—Ç–µ—Å—å —Å –∏—Å–∫—É—Å—Å—Ç–≤–µ–Ω–Ω—ã–º –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç–æ–º</p>
            </div>
            
            <div class="mode-card" onclick="selectGameMode('multiplayer')">
                <div class="mode-icon">üë•</div>
                <div class="mode-title">–ò–≥—Ä–∞ —Å –¥—Ä—É–≥–æ–º</div>
                <p>–°–æ–∑–¥–∞–π—Ç–µ –ª–æ–±–±–∏ –∏–ª–∏ –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–∏—Ç–µ—Å—å –∫ –∏–≥—Ä–µ</p>
            </div>
        </div>

        <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –≤—ã–±–æ—Ä–∞ —É—Ä–æ–≤–Ω—è –ò–ò -->
        <div id="ai-modal" class="modal-overlay hidden">
            <div class="modal">
                <div class="modal-header">
                    <div class="modal-title">–í—ã–±–æ—Ä —É—Ä–æ–≤–Ω—è —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ –ò–ò</div>
                    <button class="close-btn" onclick="closeModal('ai-modal')">√ó</button>
                </div>
                <div class="form-group">
                    <label class="form-label">–£—Ä–æ–≤–µ–Ω—å —Å–ª–æ–∂–Ω–æ—Å—Ç–∏:</label>
                    <select id="ai-level-select" class="form-input">
                        <option value="easy">üü¢ –õ–µ–≥–∫–∏–π</option>
                        <option value="medium" selected>üü° –°—Ä–µ–¥–Ω–∏–π</option>
                        <option value="hard">üî¥ –°–ª–æ–∂–Ω—ã–π</option>
                    </select>
                </div>
                <button class="btn btn-success" onclick="startAIGame()">–ù–∞—á–∞—Ç—å –∏–≥—Ä—É</button>
            </div>
        </div>

        <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –º—É–ª—å—Ç–∏–ø–ª–µ–µ—Ä–∞ -->
        <div id="multiplayer-modal" class="modal-overlay hidden">
            <div class="modal">
                <div class="modal-header">
                    <div class="modal-title">üë• –ú—É–ª—å—Ç–∏–ø–ª–µ–µ—Ä</div>
                    <button class="close-btn" onclick="closeModal('multiplayer-modal')">√ó</button>
                </div>
                
                <div style="text-align: center; margin: 20px 0;">
                    <button class="btn btn-success" onclick="showCreateLobby()" style="margin-bottom: 10px;">
                        üÜï –°–æ–∑–¥–∞—Ç—å –ª–æ–±–±–∏
                    </button>
                    <button class="btn" onclick="showLobbyList()" style="margin-bottom: 10px;">
                        üìã –°–ø–∏—Å–æ–∫ –ª–æ–±–±–∏
                    </button>
                    <button class="btn" onclick="showDirectJoin()">
                        üîó –ü—Ä—è–º–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ
                    </button>
                </div>
                
                <!-- –°–æ–∑–¥–∞–Ω–∏–µ –ª–æ–±–±–∏ -->
                <div id="create-lobby-form" class="hidden">
                    <div class="form-group">
                        <label class="form-label">–ù–∞–∑–≤–∞–Ω–∏–µ –ª–æ–±–±–∏:</label>
                        <input type="text" id="lobby-name" class="form-input" placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ" maxlength="20">
                    </div>
                    <div class="form-group">
                        <label class="form-label">–ü–∞—Ä–æ–ª—å (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ):</label>
                        <input type="password" id="lobby-password" class="form-input" placeholder="–û—Å—Ç–∞–≤—å—Ç–µ –ø—É—Å—Ç—ã–º">
                    </div>
                    <div style="text-align: center; margin-top: 20px;">
                        <button class="btn btn-success" onclick="createLobby()">–°–æ–∑–¥–∞—Ç—å –ª–æ–±–±–∏</button>
                        <button class="btn" onclick="showMultiplayerMenu()">–ù–∞–∑–∞–¥</button>
                    </div>
                </div>
                
                <!-- –°–ø–∏—Å–æ–∫ –ª–æ–±–±–∏ -->
                <div id="lobby-list-container" class="hidden">
                    <div class="form-group">
                        <input type="text" id="lobby-search" class="form-input" placeholder="–ü–æ–∏—Å–∫ –ª–æ–±–±–∏...">
                    </div>
                    
                    <div id="lobby-list" style="max-height: 300px; overflow-y: auto; margin: 20px 0; border: 1px solid var(--accent); border-radius: 5px; padding: 10px;">
                        <!-- –õ–æ–±–±–∏ –±—É–¥—É—Ç –∑–¥–µ—Å—å -->
                    </div>
                    
                    <div style="text-align: center;">
                        <button class="btn" onclick="refreshLobbyList()">üîÑ –û–±–Ω–æ–≤–∏—Ç—å</button>
                        <button class="btn" onclick="showMultiplayerMenu()">–ù–∞–∑–∞–¥</button>
                    </div>
                </div>
                
                <!-- –ü—Ä—è–º–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ -->
                <div id="direct-join-form" class="hidden">
                    <div class="form-group">
                        <label class="form-label">ID –ª–æ–±–±–∏:</label>
                        <input type="text" id="direct-lobby-id" class="form-input" placeholder="–í–≤–µ–¥–∏—Ç–µ ID –ª–æ–±–±–∏">
                    </div>
                    <div class="form-group">
                        <label class="form-label">–ü–∞—Ä–æ–ª—å (–µ—Å–ª–∏ —Ç—Ä–µ–±—É–µ—Ç—Å—è):</label>
                        <input type="password" id="direct-password" class="form-input" placeholder="–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å">
                    </div>
                    <div style="text-align: center; margin-top: 20px;">
                        <button class="btn btn-success" onclick="joinDirectLobby()">–ü—Ä–∏—Å–æ–µ–¥–∏–Ω–∏—Ç—å—Å—è</button>
                        <button class="btn" onclick="showMultiplayerMenu()">–ù–∞–∑–∞–¥</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- –≠–∫—Ä–∞–Ω –ª–æ–±–±–∏ -->
        <div id="lobby-screen" class="game-screen hidden">
            <div class="game-info">
                <div class="info-item">
                    <div class="info-label">–õ–æ–±–±–∏</div>
                    <div id="lobby-title" class="info-value">-</div>
                </div>
                <div class="info-item">
                    <div class="info-label">–°—Ç–∞—Ç—É—Å</div>
                    <div id="lobby-status" class="info-value">–û–∂–∏–¥–∞–Ω–∏–µ</div>
                </div>
                <div class="info-item">
                    <div class="info-label">–ò–≥—Ä–æ–∫–æ–≤</div>
                    <div id="lobby-players" class="info-value">1/2</div>
                </div>
                <div class="info-item">
                    <div class="info-label">ID</div>
                    <div id="lobby-id-display" class="info-value">-</div>
                </div>
            </div>

            <div style="text-align: center; margin: 20px 0;">
                <h3 style="color: var(--neon-green); margin-bottom: 10px;">üë• –ò–≥—Ä–æ–∫–∏:</h3>
                <div id="players-list" style="margin: 15px 0;">
                    <!-- –ò–≥—Ä–æ–∫–∏ –±—É–¥—É—Ç –∑–¥–µ—Å—å -->
                </div>
            </div>

            <div style="text-align: center; margin: 20px 0;">
                <button class="btn btn-success" id="ready-btn" onclick="toggleReady()">
                    ‚úÖ –ì–æ—Ç–æ–≤
                </button>
                <button class="btn" onclick="copyLobbyId()">
                    üìã –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å ID
                </button>
                <button class="btn btn-danger" onclick="leaveLobby()">
                    üö™ –ü–æ–∫–∏–Ω—É—Ç—å
                </button>
            </div>

            <div id="lobby-game-status" class="status">
                –û–∂–∏–¥–∞–Ω–∏–µ –≤—Ç–æ—Ä–æ–≥–æ –∏–≥—Ä–æ–∫–∞...
            </div>
        </div>

        <!-- –≠–∫—Ä–∞–Ω –∏–≥—Ä—ã -->
        <div id="game-screen" class="game-screen hidden">
            <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± –∏–≥—Ä–µ -->
            <div class="game-info">
                <div class="info-item">
                    <div class="info-label">–†–µ–∂–∏–º</div>
                    <div id="game-mode-display" class="info-value">-</div>
                </div>
                <div class="info-item">
                    <div class="info-label">–•–æ–¥</div>
                    <div id="turn-indicator" class="info-value">-</div>
                </div>
                <div class="info-item">
                    <div class="info-label">–ü–æ–ø–∞–¥–∞–Ω–∏—è</div>
                    <div id="hits-count" class="info-value">0/0</div>
                </div>
                <div class="info-item">
                    <div class="info-label">–ö–æ—Ä–∞–±–ª–∏</div>
                    <div id="ships-count" class="info-value">10/10</div>
                </div>
            </div>

            <!-- –í–µ—Ä—Ñ—å –¥–ª—è —Ä–∞—Å—Å—Ç–∞–Ω–æ–≤–∫–∏ –∫–æ—Ä–∞–±–ª–µ–π -->
            <div id="ship-factory" class="ship-factory">
                <h3 style="text-align: center; margin-bottom: 15px; color: var(--neon-yellow);">üö¢ –í–µ—Ä—Ñ—å –∫–æ—Ä–∞–±–ª–µ–π</h3>
                <div class="ship-types" id="ship-types-container">
                    <!-- –ö–Ω–æ–ø–∫–∏ –∫–æ—Ä–∞–±–ª–µ–π –±—É–¥—É—Ç –∑–¥–µ—Å—å -->
                </div>
                
                <div style="text-align: center; margin: 15px 0;">
                    <button class="btn" onclick="rotateShip()">
                        üîÑ –ü–æ–≤–æ—Ä–æ—Ç
                    </button>
                    <button class="btn" onclick="clearShips()">
                        üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å
                    </button>
                    <button class="btn" onclick="randomPlacement()">
                        üé≤ –°–ª—É—á–∞–π–Ω–æ
                    </button>
                    <button id="start-game-btn" class="btn btn-success" onclick="startBattle()" disabled>
                        ‚öîÔ∏è –ù–∞—á–∞—Ç—å –±–∏—Ç–≤—É!
                    </button>
                </div>
            </div>

            <!-- –ò–≥—Ä–æ–≤—ã–µ –ø–æ–ª—è -->
            <div class="game-area">
                <div class="grid-container">
                    <div class="grid-title">üéØ –í–∞—à —Ñ–ª–æ—Ç</div>
                    <div id="player-grid" class="grid"></div>
                </div>
                
                <div class="grid-container">
                    <div class="grid-title">üéØ –§–ª–æ—Ç –ø—Ä–æ—Ç–∏–≤–Ω–∏–∫–∞</div>
                    <div id="enemy-grid" class="grid"></div>
                </div>
            </div>

            <!-- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏–≥—Ä–æ–π -->
            <div style="text-align: center; margin: 20px 0;">
                <button class="btn" onclick="aiMakeMove()" id="ai-move-btn" disabled>
                    ü§ñ –•–æ–¥ –ò–ò
                </button>
                <button class="btn" onclick="surrender()">
                    üè≥Ô∏è –°–¥–∞—Ç—å—Å—è
                </button>
                <button class="btn" onclick="restartGame()">
                    üîÑ –ù–æ–≤–∞—è –∏–≥—Ä–∞
                </button>
            </div>

            <!-- –°—Ç–∞—Ç—É—Å –∏–≥—Ä—ã -->
            <div id="game-status" class="status">
                –†–∞—Å—Å—Ç–∞–≤—å—Ç–µ –≤–∞—à–∏ –∫–æ—Ä–∞–±–ª–∏ –Ω–∞ –ø–æ–ª–µ
            </div>
        </div>

        <!-- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è -->
        <div id="notification-container"></div>
    </div>

    <!-- Socket.io -->
    <script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>

    <script>
        // ==================== –ì–õ–û–ë–ê–õ–¨–ù–´–ï –ü–ï–†–ï–ú–ï–ù–ù–´–ï ====================
        let gameMode = null;
        let aiLevel = 'medium';
        let gameActive = false;
        let placementPhase = true;
        let currentShipSize = 4;
        let isVertical = false;
        let playerTurn = true;
        let myTurn = false; // –î–ª—è –º—É–ª—å—Ç–∏–ø–ª–µ–µ—Ä–∞ - –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç, –º–æ–π –ª–∏ —Å–µ–π—á–∞—Å —Ö–æ–¥
        
        // –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
        let movesCount = 0;
        let playerHits = 0;
        let playerShots = 0;
        let aiHits = 0;
        let aiShots = 0;
        
        // –õ–∏–º–∏—Ç—ã –∫–æ—Ä–∞–±–ª–µ–π
        const shipLimits = { 4: 1, 3: 2, 2: 3, 1: 4 };
        let placedShips = { 4: 0, 3: 0, 2: 0, 1: 0 };
        
        // –ò–≥—Ä–æ–≤—ã–µ –ø–æ–ª—è
        let playerGrid = Array(100).fill(null);
        let enemyGrid = Array(100).fill(null);
        let playerShips = new Map();
        let enemyShips = new Map();
        
        // –î–ª—è –º—É–ª—å—Ç–∏–ø–ª–µ–µ—Ä–∞
        let socket = null;
        let currentLobby = null;
        let playerName = `–ò–≥—Ä–æ–∫_${Math.floor(Math.random() * 1000)}`;
        let isReady = false;
        let myPlayerNumber = 0;
        
        // –î–ª—è –ò–ò
        let aiMemory = {
            lastHit: null,
            hitDirection: null,
            huntMode: false,
            triedCells: new Set()
        };
        
        // DOM —ç–ª–µ–º–µ–Ω—Ç—ã
        const playerGridEl = document.getElementById('player-grid');
        const enemyGridEl = document.getElementById('enemy-grid');
        const gameStatus = document.getElementById('game-status');
        
        // ==================== –£–ü–†–ê–í–õ–ï–ù–ò–ï –ò–ù–¢–ï–†–§–ï–ô–°–û–ú ====================
        
        function selectGameMode(mode) {
            gameMode = mode;
            
            if (mode === 'ai') {
                showModal('ai-modal');
            } else if (mode === 'multiplayer') {
                showModal('multiplayer-modal');
                initMultiplayer();
            }
        }
        
        function showModal(modalId) {
            document.getElementById(modalId).classList.remove('hidden');
        }
        
        function closeModal(modalId) {
            document.getElementById(modalId).classList.add('hidden');
        }
        
        function showMultiplayerMenu() {
            document.getElementById('create-lobby-form').classList.add('hidden');
            document.getElementById('lobby-list-container').classList.add('hidden');
            document.getElementById('direct-join-form').classList.add('hidden');
        }
        
        function showCreateLobby() {
            showMultiplayerMenu();
            document.getElementById('create-lobby-form').classList.remove('hidden');
        }
        
        function showLobbyList() {
            showMultiplayerMenu();
            document.getElementById('lobby-list-container').classList.remove('hidden');
            refreshLobbyList();
        }
        
        function showDirectJoin() {
            showMultiplayerMenu();
            document.getElementById('direct-join-form').classList.remove('hidden');
        }
        
        // ==================== –£–í–ï–î–û–ú–õ–ï–ù–ò–Ø ====================
        
        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = `notification notification-${type}`;
            notification.textContent = message;
            notification.style.animation = 'fadeIn 0.3s';
            
            document.getElementById('notification-container').appendChild(notification);
            
            setTimeout(() => {
                notification.style.animation = 'fadeOut 0.3s';
                setTimeout(() => {
                    notification.remove();
                }, 300);
            }, 3000);
        }
        
        // ==================== –ú–£–õ–¨–¢–ò–ü–õ–ï–ï–† ====================
        
        function initMultiplayer() {
            console.log('–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –º—É–ª—å—Ç–∏–ø–ª–µ–µ—Ä–∞...');
            
            // –ü–æ–¥–∫–ª—é—á–∞–µ–º—Å—è –∫ —Å–µ—Ä–≤–µ—Ä—É
            socket = io();
            
            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π
            socket.on('connect', () => {
                console.log('‚úÖ –ü–æ–¥–∫–ª—é—á–µ–Ω –∫ —Å–µ—Ä–≤–µ—Ä—É');
                showNotification('–ü–æ–¥–∫–ª—é—á–µ–Ω–æ –∫ —Å–µ—Ä–≤–µ—Ä—É', 'success');
            });
            
            socket.on('connect_error', (error) => {
                console.error('–û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è:', error);
                showNotification('–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ —Å–µ—Ä–≤–µ—Ä—É', 'error');
            });
            
            socket.on('lobbyCreated', (data) => {
                console.log('‚úÖ –õ–æ–±–±–∏ —Å–æ–∑–¥–∞–Ω–æ:', data);
                currentLobby = data;
                showLobbyScreen();
                showNotification(`–õ–æ–±–±–∏ "${data.name}" —Å–æ–∑–¥–∞–Ω–æ! ID: ${data.id}`, 'success');
            });
            
            socket.on('lobbyJoined', (data) => {
                console.log('‚úÖ –ü—Ä–∏—Å–æ–µ–¥–∏–Ω–∏–ª—Å—è –∫ –ª–æ–±–±–∏:', data);
                currentLobby = data;
                showLobbyScreen();
                showNotification(`–í—ã –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–∏–ª–∏—Å—å –∫ –ª–æ–±–±–∏ "${data.name}"`, 'success');
            });
            
            socket.on('lobbyError', (error) => {
                console.error('–û—à–∏–±–∫–∞ –ª–æ–±–±–∏:', error);
                showNotification(error, 'error');
            });
            
            socket.on('lobbyList', (lobbies) => {
                updateLobbyList(lobbies);
            });
            
            socket.on('playerJoined', (data) => {
                console.log('üë§ –ò–≥—Ä–æ–∫ –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–∏–ª—Å—è:', data);
                updatePlayersList();
                showNotification(`${data.name} –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–∏–ª—Å—è –∫ –ª–æ–±–±–∏`, 'success');
            });
            
            socket.on('playerLeft', (data) => {
                console.log('üë§ –ò–≥—Ä–æ–∫ –ø–æ–∫–∏–Ω—É–ª:', data);
                updatePlayersList();
                showNotification(`${data.name} –ø–æ–∫–∏–Ω—É–ª –ª–æ–±–±–∏`, 'warning');
            });
            
            socket.on('playerReady', (data) => {
                console.log('‚úÖ –ò–≥—Ä–æ–∫ –≥–æ—Ç–æ–≤:', data);
                updatePlayersList();
                
                if (data.playerId !== socket.id) {
                    showNotification(`${data.playerName} ${data.ready ? '–≥–æ—Ç–æ–≤' : '–Ω–µ –≥–æ—Ç–æ–≤'}`, 'info');
                }
            });
            
            // –ù–û–í–û–ï: –ö–æ–≥–¥–∞ –æ–±–∞ –∏–≥—Ä–æ–∫–∞ –≥–æ—Ç–æ–≤—ã, —Å–µ—Ä–≤–µ—Ä –Ω–∞—á–∏–Ω–∞–µ—Ç –∏–≥—Ä—É
            socket.on('gameStart', (data) => {
                console.log('üöÄ –ò–≥—Ä–∞ –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è:', data);
                startMultiplayerGame(data);
                showNotification('–ò–≥—Ä–∞ –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è!', 'success');
            });
            
            // –ù–û–í–û–ï: –ü–æ–ª—É—á–µ–Ω–∏–µ —Ö–æ–¥–∞ –ø—Ä–æ—Ç–∏–≤–Ω–∏–∫–∞
            socket.on('enemyMove', (data) => {
                console.log('üéØ –•–æ–¥ –ø—Ä–æ—Ç–∏–≤–Ω–∏–∫–∞:', data);
                // –ü—Ä–æ—Ç–∏–≤–Ω–∏–∫ —Å–¥–µ–ª–∞–ª —Ö–æ–¥ –ø–æ –Ω–∞—à–µ–π –∫–ª–µ—Ç–∫–µ
                handleEnemyMove(data);
            });
            
            // –ù–û–í–û–ï: –†–µ–∑—É–ª—å—Ç–∞—Ç –Ω–∞—à–µ–≥–æ –≤—ã—Å—Ç—Ä–µ–ª–∞
            socket.on('shotResult', (data) => {
                console.log('üéØ –†–µ–∑—É–ª—å—Ç–∞—Ç –Ω–∞—à–µ–≥–æ –≤—ã—Å—Ç—Ä–µ–ª–∞:', data);
                handleOurShotResult(data);
            });
            
            // –ù–û–í–û–ï: –†–µ–∑—É–ª—å—Ç–∞—Ç –≤—ã—Å—Ç—Ä–µ–ª–∞ –ø—Ä–æ—Ç–∏–≤–Ω–∏–∫–∞ –ø–æ –Ω–∞–º
            socket.on('enemyShotResult', (data) => {
                console.log('üéØ –†–µ–∑—É–ª—å—Ç–∞—Ç –≤—ã—Å—Ç—Ä–µ–ª–∞ –ø—Ä–æ—Ç–∏–≤–Ω–∏–∫–∞:', data);
                handleEnemyShotResult(data);
            });
            
            // –ù–û–í–û–ï: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ö–æ–¥–∞
            socket.on('turnUpdate', (data) => {
                console.log('üîÑ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ö–æ–¥–∞:', data);
                myTurn = data.currentTurn === socket.id;
                updateTurnIndicator();
                
                if (myTurn) {
                    gameStatus.textContent = '–í–∞—à —Ö–æ–¥! –ê—Ç–∞–∫—É–π—Ç–µ –ø–æ–ª–µ –ø—Ä–æ—Ç–∏–≤–Ω–∏–∫–∞.';
                } else {
                    gameStatus.textContent = '–•–æ–¥ –ø—Ä–æ—Ç–∏–≤–Ω–∏–∫–∞...';
                }
            });
            
            socket.on('gameOver', (data) => {
                console.log('üèÅ –ò–≥—Ä–∞ –æ–∫–æ–Ω—á–µ–Ω–∞:', data);
                endGame(data.winner === socket.id);
            });
        }
        
        function createLobby() {
            const name = document.getElementById('lobby-name').value.trim();
            const password = document.getElementById('lobby-password').value;
            
            if (!name) {
                showNotification('–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –ª–æ–±–±–∏', 'error');
                return;
            }
            
            socket.emit('createLobby', {
                name: name,
                password: password || null,
                playerName: playerName
            });
        }
        
        function refreshLobbyList() {
            socket.emit('getLobbies');
            showNotification('–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –ª–æ–±–±–∏...', 'info');
        }
        
        function updateLobbyList(lobbies) {
            const lobbyListEl = document.getElementById('lobby-list');
            lobbyListEl.innerHTML = '';
            
            if (lobbies.length === 0) {
                lobbyListEl.innerHTML = '<div style="text-align: center; padding: 20px; color: #BBDEFB;">–ù–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –ª–æ–±–±–∏</div>';
                return;
            }
            
            lobbies.forEach(lobby => {
                const lobbyItem = document.createElement('div');
                lobbyItem.className = 'lobby-item';
                lobbyItem.style.cssText = `
                    background: rgba(255, 255, 255, 0.1);
                    padding: 10px;
                    margin: 5px 0;
                    border-radius: 5px;
                    cursor: pointer;
                    border: 1px solid ${lobby.hasPassword ? '#E040FB' : '#536DFE'};
                `;
                lobbyItem.onclick = () => joinLobby(lobby.id);
                
                lobbyItem.innerHTML = `
                    <div style="font-weight: bold; color: #FFEB3B;">${lobby.name}</div>
                    <div style="font-size: 14px; color: #BBDEFB;">
                        üë• ${lobby.players}/${lobby.maxPlayers}
                        ${lobby.hasPassword ? ' üîí' : ''}
                    </div>
                `;
                
                lobbyListEl.appendChild(lobbyItem);
            });
        }
        
        function joinLobby(lobbyId) {
            socket.emit('joinLobby', {
                lobbyId: lobbyId,
                playerName: playerName
            });
        }
        
        function joinDirectLobby() {
            const lobbyId = document.getElementById('direct-lobby-id').value.trim();
            const password = document.getElementById('direct-password').value;
            
            if (!lobbyId) {
                showNotification('–í–≤–µ–¥–∏—Ç–µ ID –ª–æ–±–±–∏', 'error');
                return;
            }
            
            socket.emit('joinLobby', {
                lobbyId: lobbyId,
                password: password || null,
                playerName: playerName
            });
        }
        
        function showLobbyScreen() {
            document.getElementById('main-menu').classList.add('hidden');
            document.getElementById('multiplayer-modal').classList.add('hidden');
            document.getElementById('lobby-screen').classList.remove('hidden');
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ª–æ–±–±–∏
            document.getElementById('lobby-title').textContent = currentLobby.name;
            document.getElementById('lobby-id-display').textContent = currentLobby.id;
            document.getElementById('lobby-status').textContent = 
                currentLobby.players.length >= currentLobby.maxPlayers ? '–ó–∞–ø–æ–ª–Ω–µ–Ω–æ' : '–û–∂–∏–¥–∞–Ω–∏–µ';
            document.getElementById('lobby-players').textContent = 
                `${currentLobby.players.length}/${currentLobby.maxPlayers}`;
            
            updatePlayersList();
        }
        
        function updatePlayersList() {
            const playersList = document.getElementById('players-list');
            playersList.innerHTML = '';
            
            if (!currentLobby || !currentLobby.players) return;
            
            currentLobby.players.forEach(player => {
                const playerDiv = document.createElement('div');
                playerDiv.className = 'player-item';
                playerDiv.style.cssText = `
                    background: rgba(255, 255, 255, 0.1);
                    padding: 10px 15px;
                    margin: 5px 0;
                    border-radius: 8px;
                    display: flex;
                    justify-content: space-between;
                    align-items: center;
                    border: 2px solid ${player.ready ? '#00E676' : '#536DFE'};
                `;
                
                playerDiv.innerHTML = `
                    <div>
                        <strong style="color: #FFEB3B;">${player.name}</strong>
                        ${player.id === socket.id ? ' (–í—ã)' : ''}
                    </div>
                    <div style="color: ${player.ready ? '#00E676' : '#536DFE'};">
                        ${player.ready ? '‚úÖ –ì–æ—Ç–æ–≤' : '‚è≥ –û–∂–∏–¥–∞–Ω–∏–µ'}
                    </div>
                `;
                
                playersList.appendChild(playerDiv);
            });
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å—á–µ—Ç—á–∏–∫ –∏–≥—Ä–æ–∫–æ–≤
            document.getElementById('lobby-players').textContent = 
                `${currentLobby.players.length}/${currentLobby.maxPlayers}`;
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –≤—Å–µ –ª–∏ –≥–æ—Ç–æ–≤—ã
            if (currentLobby.players.length === currentLobby.maxPlayers) {
                const allReady = currentLobby.players.every(p => p.ready);
                if (allReady) {
                    document.getElementById('lobby-game-status').textContent = 
                        '–í—Å–µ –∏–≥—Ä–æ–∫–∏ –≥–æ—Ç–æ–≤—ã! –ò–≥—Ä–∞ –Ω–∞—á–Ω–µ—Ç—Å—è —á–µ—Ä–µ–∑ 3 —Å–µ–∫—É–Ω–¥—ã...';
                    
                    setTimeout(() => {
                        if (currentLobby.players.every(p => p.ready)) {
                            socket.emit('startGame');
                        }
                    }, 3000);
                }
            }
        }
        
        function toggleReady() {
            isReady = !isReady;
            socket.emit('setReady', isReady);
            document.getElementById('ready-btn').textContent = 
                isReady ? '‚ùå –û—Ç–º–µ–Ω–∏—Ç—å –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç—å' : '‚úÖ –ì–æ—Ç–æ–≤ –∫ –∏–≥—Ä–µ';
        }
        
        function copyLobbyId() {
            navigator.clipboard.writeText(currentLobby.id).then(() => {
                showNotification('ID –ª–æ–±–±–∏ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞', 'success');
            });
        }
        
        function leaveLobby() {
            socket.emit('leaveLobby');
            currentLobby = null;
            document.getElementById('lobby-screen').classList.add('hidden');
            document.getElementById('main-menu').classList.remove('hidden');
            showNotification('–í—ã –ø–æ–∫–∏–Ω—É–ª–∏ –ª–æ–±–±–∏', 'info');
        }
        
        // ==================== –ú–£–õ–¨–¢–ò–ü–õ–ï–ï–† –ò–ì–†–ê ====================
        
        function startMultiplayerGame(data) {
            console.log('–ù–∞—á–∞–ª–æ –º—É–ª—å—Ç–∏–ø–ª–µ–µ—Ä–Ω–æ–π –∏–≥—Ä—ã');
            
            gameMode = 'multiplayer';
            myPlayerNumber = data.playerNumber;
            myTurn = data.canMove;
            gameActive = true;
            placementPhase = true;
            
            // –°–∫—Ä—ã–≤–∞–µ–º –ª–æ–±–±–∏, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–≥—Ä–æ–≤–æ–π —ç–∫—Ä–∞–Ω
            document.getElementById('lobby-screen').classList.add('hidden');
            document.getElementById('game-screen').classList.remove('hidden');
            
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –∏–≥—Ä—É
            initGame();
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ä–µ–∂–∏–º–µ
            document.getElementById('game-mode-display').textContent = '–ü—Ä–æ—Ç–∏–≤ –∏–≥—Ä–æ–∫–∞';
            updateTurnIndicator();
            
            if (myTurn) {
                gameStatus.textContent = '–†–∞—Å—Å—Ç–∞–≤—å—Ç–µ –∫–æ—Ä–∞–±–ª–∏. –£ –≤–∞—Å –ø–µ—Ä–≤—ã–π —Ö–æ–¥!';
            } else {
                gameStatus.textContent = '–†–∞—Å—Å—Ç–∞–≤—å—Ç–µ –∫–æ—Ä–∞–±–ª–∏. –ü–µ—Ä–≤—ã–π —Ö–æ–¥ —É –ø—Ä–æ—Ç–∏–≤–Ω–∏–∫–∞.';
            }
        }
        
        function handleEnemyMove(data) {
            // –ü—Ä–æ—Ç–∏–≤–Ω–∏–∫ –≤—ã—Å—Ç—Ä–µ–ª–∏–ª –≤ –Ω–∞—à—É –∫–ª–µ—Ç–∫—É
            const index = data.index;
            const cell = document.getElementById(`player-${index}`);
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ–ø–∞–¥–∞–Ω–∏–µ
            const shipId = playerGrid[index];
            if (shipId) {
                // –ü–æ–ø–∞–¥–∞–Ω–∏–µ
                cell.classList.add('hit');
                const ship = playerShips.get(shipId);
                ship.health--;
                
                // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç –Ω–∞ —Å–µ—Ä–≤–µ—Ä
                socket.emit('shotResult', {
                    index: index,
                    hit: true,
                    killed: ship.health === 0,
                    coords: ship.health === 0 ? ship.cells : null
                });
                
                if (ship.health === 0) {
                    markAroundShip(ship.cells, 'player');
                }
                
                // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Ä–∞–∂–µ–Ω–∏—è
                if (checkPlayerDefeat()) {
                    socket.emit('gameOver', { winner: data.playerId });
                }
            } else {
                // –ü—Ä–æ–º–∞—Ö
                cell.classList.add('miss');
                socket.emit('shotResult', {
                    index: index,
                    hit: false,
                    killed: false
                });
            }
            
            updateGameInfo();
        }
        
        function handleOurShotResult(data) {
            // –†–µ–∑—É–ª—å—Ç–∞—Ç –Ω–∞—à–µ–≥–æ –≤—ã—Å—Ç—Ä–µ–ª–∞
            const cell = document.getElementById(`enemy-${data.index}`);
            
            if (data.hit) {
                cell.classList.add('hit');
                playerHits++;
                
                if (data.killed) {
                    markAroundShip(data.coords, 'enemy');
                    gameStatus.textContent = 'üíÄ –ö–û–†–ê–ë–õ–¨ –ü–†–û–¢–ò–í–ù–ò–ö–ê –£–ë–ò–¢!';
                } else {
                    gameStatus.textContent = 'üéØ –ü–û–ü–ê–î–ê–ù–ò–ï!';
                }
                
                // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–±–µ–¥—ã
                if (checkEnemyDefeat()) {
                    endGame(true);
                    return;
                }
            } else {
                cell.classList.add('miss');
                gameStatus.textContent = 'üåÄ –ü–†–û–ú–ê–•!';
            }
            
            updateGameInfo();
        }
        
        function handleEnemyShotResult(data) {
            // –†–µ–∑—É–ª—å—Ç–∞—Ç –≤—ã—Å—Ç—Ä–µ–ª–∞ –ø—Ä–æ—Ç–∏–≤–Ω–∏–∫–∞ –ø–æ –Ω–∞–º
            const cell = document.getElementById(`player-${data.index}`);
            
            if (data.hit) {
                cell.classList.add('hit');
                const shipId = playerGrid[data.index];
                if (shipId) {
                    const ship = playerShips.get(shipId);
                    ship.health--;
                    
                    if (ship.health === 0) {
                        markAroundShip(ship.cells, 'player');
                        gameStatus.textContent = 'üíî –í–∞—à –∫–æ—Ä–∞–±–ª—å —É–Ω–∏—á—Ç–æ–∂–µ–Ω!';
                    } else {
                        gameStatus.textContent = 'üí• –ü–æ–ø–∞–¥–∞–Ω–∏–µ –ø–æ –≤–∞—à–µ–º—É –∫–æ—Ä–∞–±–ª—é!';
                    }
                }
                
                // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Ä–∞–∂–µ–Ω–∏—è
                if (checkPlayerDefeat()) {
                    endGame(false);
                    return;
                }
            } else {
                cell.classList.add('miss');
                gameStatus.textContent = 'üåÄ –ü—Ä–æ—Ç–∏–≤–Ω–∏–∫ –ø—Ä–æ–º–∞—Ö–Ω—É–ª—Å—è!';
            }
            
            updateGameInfo();
        }
        
        // ==================== –ò–ì–†–ê –ü–†–û–¢–ò–í –ò–ò ====================
        
        function startAIGame() {
            aiLevel = document.getElementById('ai-level-select').value;
            closeModal('ai-modal');
            document.getElementById('main-menu').classList.add('hidden');
            document.getElementById('game-screen').classList.remove('hidden');
            
            gameMode = 'ai';
            gameActive = true;
            placementPhase = true;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ä–µ–∂–∏–º–µ
            document.getElementById('game-mode-display').textContent = 
                `–ü—Ä–æ—Ç–∏–≤ –ò–ò (${aiLevel === 'easy' ? '–õ–µ–≥–∫–∏–π' : aiLevel === 'medium' ? '–°—Ä–µ–¥–Ω–∏–π' : '–°–ª–æ–∂–Ω—ã–π'})`;
            
            initGame();
            
            // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –∫–æ—Ä–∞–±–ª–∏ –ò–ò
            generateAIShips();
        }
        
        // ==================== –û–ë–©–ê–Ø –õ–û–ì–ò–ö–ê –ò–ì–†–´ ====================
        
        function initGame() {
            // –°–±—Ä–æ—Å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö
            playerGrid = Array(100).fill(null);
            enemyGrid = Array(100).fill(null);
            playerShips.clear();
            placedShips = { 4: 0, 3: 0, 2: 0, 1: 0 };
            movesCount = 0;
            playerHits = 0;
            playerShots = 0;
            aiHits = 0;
            aiShots = 0;
            
            // –°–æ–∑–¥–∞–µ–º —Å–µ—Ç–∫–∏
            createGrids();
            createShipButtons();
            selectShipSize(4);
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å
            gameStatus.textContent = '–†–∞—Å—Å—Ç–∞–≤—å—Ç–µ –≤–∞—à–∏ –∫–æ—Ä–∞–±–ª–∏ –Ω–∞ –ø–æ–ª–µ';
            document.getElementById('start-game-btn').disabled = true;
            
            // –°–∫—Ä—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É —Ö–æ–¥–∞ –ò–ò –µ—Å–ª–∏ –Ω–µ –∏–≥—Ä–∞ —Å –ò–ò
            document.getElementById('ai-move-btn').classList.toggle('hidden', gameMode !== 'ai');
        }
        
        function createGrids() {
            playerGridEl.innerHTML = '';
            enemyGridEl.innerHTML = '';
            
            // –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—è –∏–≥—Ä–æ–∫–∞
            for (let i = 0; i < 100; i++) {
                const cell = document.createElement('div');
                cell.className = 'cell';
                cell.dataset.index = i;
                cell.id = `player-${i}`;
                
                // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è —Ä–∞—Å—Å—Ç–∞–Ω–æ–≤–∫–∏ –∫–æ—Ä–∞–±–ª–µ–π
                cell.addEventListener('click', () => placePlayerShip(i));
                cell.addEventListener('mouseenter', () => showShipPreview(i));
                cell.addEventListener('mouseleave', () => hideShipPreview(i));
                
                playerGridEl.appendChild(cell);
            }
            
            // –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—è –ø—Ä–æ—Ç–∏–≤–Ω–∏–∫–∞
            for (let i = 0; i < 100; i++) {
                const cell = document.createElement('div');
                cell.className = 'cell';
                cell.dataset.index = i;
                cell.id = `enemy-${i}`;
                
                // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –∞—Ç–∞–∫–∏
                cell.addEventListener('click', () => attackEnemy(i));
                
                enemyGridEl.appendChild(cell);
            }
        }
        
        function createShipButtons() {
            const container = document.getElementById('ship-types-container');
            container.innerHTML = '';
            
            for (let size = 4; size >= 1; size--) {
                const button = document.createElement('button');
                button.className = 'ship-type-btn';
                button.id = `ship-btn-${size}`;
                button.onclick = () => selectShipSize(size);
                
                const remaining = shipLimits[size] - placedShips[size];
                button.innerHTML = `
                    <div style="display: flex; align-items: center; gap: 10px;">
                        <div style="width: ${size * 20}px; height: 20px; background: #4CAF50; border-radius: 3px;"></div>
                        <span>${size}-–ø–∞–ª—É–±–Ω—ã–π (${remaining}/${shipLimits[size]})</span>
                    </div>
                `;
                
                container.appendChild(button);
            }
        }
        
        function selectShipSize(size) {
            currentShipSize = size;
            
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ UI
            document.querySelectorAll('.ship-type-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            const btn = document.getElementById(`ship-btn-${size}`);
            if (btn) btn.classList.add('active');
        }
        
        function rotateShip() {
            isVertical = !isVertical;
        }
        
        function showShipPreview(index) {
            if (!placementPhase) return;
            
            const coords = getShipCoordinates(index, currentShipSize, isVertical);
            if (!coords) return;
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ —Ä–∞–∑–º–µ—â–µ–Ω–∏—è
            const canPlace = canPlaceShip(coords);
            
            coords.forEach(coord => {
                const cell = document.getElementById(`player-${coord}`);
                if (cell) {
                    cell.classList.add(canPlace ? 'preview' : 'invalid-preview');
                }
            });
        }
        
        function hideShipPreview(index) {
            if (!placementPhase) return;
            
            const coords = getShipCoordinates(index, currentShipSize, isVertical);
            if (!coords) return;
            
            coords.forEach(coord => {
                const cell = document.getElementById(`player-${coord}`);
                if (cell) {
                    cell.classList.remove('preview', 'invalid-preview');
                }
            });
        }
        
        function getShipCoordinates(startIndex, size, vertical) {
            const coords = [];
            const row = Math.floor(startIndex / 10);
            const col = startIndex % 10;
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –≥—Ä–∞–Ω–∏—Ü
            if (vertical) {
                if (row + size > 10) return null;
                for (let i = 0; i < size; i++) {
                    coords.push((row + i) * 10 + col);
                }
            } else {
                if (col + size > 10) return null;
                for (let i = 0; i < size; i++) {
                    coords.push(row * 10 + (col + i));
                }
            }
            
            return coords;
        }
        
        function canPlaceShip(coords) {
            for (const coord of coords) {
                const row = Math.floor(coord / 10);
                const col = coord % 10;
                
                // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–∞–º–æ–π –∫–ª–µ—Ç–∫–∏
                if (playerGrid[coord] !== null) return false;
                
                // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Å–µ–¥–Ω–∏—Ö –∫–ª–µ—Ç–æ–∫
                for (let dr = -1; dr <= 1; dr++) {
                    for (let dc = -1; dc <= 1; dc++) {
                        const nr = row + dr;
                        const nc = col + dc;
                        
                        if (nr >= 0 && nr < 10 && nc >= 0 && nc < 10) {
                            const neighborIndex = nr * 10 + nc;
                            if (playerGrid[neighborIndex] !== null) return false;
                        }
                    }
                }
            }
            
            return true;
        }
        
        function placePlayerShip(index) {
            if (!placementPhase) return;
            
            if (placedShips[currentShipSize] >= shipLimits[currentShipSize]) {
                showNotification(`–õ–∏–º–∏—Ç –∫–æ—Ä–∞–±–ª–µ–π —Ä–∞–∑–º–µ—Ä–æ–º ${currentShipSize} –∏—Å—á–µ—Ä–ø–∞–Ω`, 'warning');
                return;
            }
            
            const coords = getShipCoordinates(index, currentShipSize, isVertical);
            if (!coords || !canPlaceShip(coords)) {
                showNotification('–ù–µ–≤–æ–∑–º–æ–∂–Ω–æ —Ä–∞–∑–º–µ—Å—Ç–∏—Ç—å –∫–æ—Ä–∞–±–ª—å –∑–¥–µ—Å—å!', 'error');
                return;
            }
            
            // –°–æ–∑–¥–∞–Ω–∏–µ –∫–æ—Ä–∞–±–ª—è
            const shipId = `ship-${Date.now()}-${currentShipSize}`;
            playerShips.set(shipId, {
                size: currentShipSize,
                cells: coords,
                health: currentShipSize
            });
            
            // –ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ —Å–µ—Ç–∫–∏
            coords.forEach(coord => {
                playerGrid[coord] = shipId;
                const cell = document.getElementById(`player-${coord}`);
                cell.classList.add('ship');
                cell.classList.remove('preview', 'invalid-preview');
            });
            
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—á–µ—Ç—á–∏–∫–æ–≤
            placedShips[currentShipSize]++;
            updateShipCounts();
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —Ä–∞—Å—Å—Ç–∞–Ω–æ–≤–∫–∏
            const totalShips = Object.values(placedShips).reduce((a, b) => a + b, 0);
            if (totalShips === 10) {
                document.getElementById('start-game-btn').disabled = false;
                gameStatus.textContent = '–í—Å–µ –∫–æ—Ä–∞–±–ª–∏ —Ä–∞–∑–º–µ—â–µ–Ω—ã! –ù–∞–∂–º–∏—Ç–µ "–ù–∞—á–∞—Ç—å –±–∏—Ç–≤—É!"';
            } else {
                // –ê–≤—Ç–æ–≤—ã–±–æ—Ä —Å–ª–µ–¥—É—é—â–µ–≥–æ –∫–æ—Ä–∞–±–ª—è
                const nextSize = [4, 3, 2, 1].find(s => placedShips[s] < shipLimits[s]);
                if (nextSize) selectShipSize(nextSize);
            }
        }
        
        function clearShips() {
            if (!placementPhase) return;
            
            // –°–±—Ä–æ—Å –¥–∞–Ω–Ω—ã—Ö
            playerGrid = Array(100).fill(null);
            playerShips.clear();
            placedShips = { 4: 0, 3: 0, 2: 0, 1: 0 };
            
            // –°–±—Ä–æ—Å UI
            for (let i = 0; i < 100; i++) {
                const cell = document.getElementById(`player-${i}`);
                cell.className = 'cell';
                
                // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏
                cell.addEventListener('click', () => placePlayerShip(i));
                cell.addEventListener('mouseenter', () => showShipPreview(i));
                cell.addEventListener('mouseleave', () => hideShipPreview(i));
            }
            
            document.getElementById('start-game-btn').disabled = true;
            selectShipSize(4);
            updateShipCounts();
            gameStatus.textContent = '–í—Å–µ –∫–æ—Ä–∞–±–ª–∏ —É–¥–∞–ª–µ–Ω—ã. –ù–∞—á–Ω–∏—Ç–µ —Ä–∞—Å—Å—Ç–∞–Ω–æ–≤–∫—É –∑–∞–Ω–æ–≤–æ.';
        }
        
        function randomPlacement() {
            if (!placementPhase) return;
            
            clearShips();
            
            // –†–∞–∑–º–µ—â–µ–Ω–∏–µ –∫–æ—Ä–∞–±–ª–µ–π –≤ —Å–ª—É—á–∞–π–Ω—ã—Ö –ø–æ–∑–∏—Ü–∏—è—Ö
            const shipSizes = [4, 3, 3, 2, 2, 2, 1, 1, 1, 1];
            
            shipSizes.forEach(size => {
                let placed = false;
                let attempts = 0;
                
                while (!placed && attempts < 1000) {
                    attempts++;
                    const randomIndex = Math.floor(Math.random() * 100);
                    const randomVertical = Math.random() < 0.5;
                    
                    const coords = getShipCoordinates(randomIndex, size, randomVertical);
                    if (coords && canPlaceShip(coords)) {
                        const shipId = `ship-${Date.now()}-${size}`;
                        playerShips.set(shipId, {
                            size: size,
                            cells: coords,
                            health: size
                        });
                        
                        coords.forEach(coord => {
                            playerGrid[coord] = shipId;
                        });
                        
                        placedShips[size]++;
                        placed = true;
                    }
                }
            });
            
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ UI
            updateShipCounts();
            renderPlayerShips();
            
            const totalShips = Object.values(placedShips).reduce((a, b) => a + b, 0);
            if (totalShips === 10) {
                document.getElementById('start-game-btn').disabled = false;
                gameStatus.textContent = '–ö–æ—Ä–∞–±–ª–∏ —Ä–∞—Å—Å—Ç–∞–≤–ª–µ–Ω—ã —Å–ª—É—á–∞–π–Ω—ã–º –æ–±—Ä–∞–∑–æ–º!';
            }
        }
        
        function renderPlayerShips() {
            for (let i = 0; i < 100; i++) {
                const cell = document.getElementById(`player-${i}`);
                cell.className = 'cell';
                
                if (playerGrid[i]) {
                    cell.classList.add('ship');
                }
            }
        }
        
        function updateShipCounts() {
            for (let size = 1; size <= 4; size++) {
                const remaining = shipLimits[size] - placedShips[size];
                const btn = document.getElementById(`ship-btn-${size}`);
                if (btn) {
                    btn.innerHTML = `
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <div style="width: ${size * 20}px; height: 20px; background: #4CAF50; border-radius: 3px;"></div>
                            <span>${size}-–ø–∞–ª—É–±–Ω—ã–π (${placedShips[size]}/${shipLimits[size]})</span>
                        </div>
                    `;
                    
                    if (remaining === 0) {
                        btn.disabled = true;
                        btn.style.opacity = '0.6';
                    } else {
                        btn.disabled = false;
                        btn.style.opacity = '1';
                    }
                }
            }
        }
        
        function startBattle() {
            placementPhase = false;
            
            if (gameMode === 'ai') {
                playerTurn = true;
                document.getElementById('ai-move-btn').disabled = false;
                gameStatus.textContent = '–ë–∏—Ç–≤–∞ –Ω–∞—á–∞–ª–∞—Å—å! –í–∞—à —Ö–æ–¥.';
            } else if (gameMode === 'multiplayer') {
                // –í –º—É–ª—å—Ç–∏–ø–ª–µ–µ—Ä–µ —Å–æ–æ–±—â–∞–µ–º —Å–µ—Ä–≤–µ—Ä—É, —á—Ç–æ –º—ã –≥–æ—Ç–æ–≤—ã
                socket.emit('playerShipsReady');
                gameStatus.textContent = '–û–∂–∏–¥–∞–Ω–∏–µ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ –ø—Ä–æ—Ç–∏–≤–Ω–∏–∫–∞...';
                document.getElementById('start-game-btn').disabled = true;
            }
            
            // –î–µ–∞–∫—Ç–∏–≤–∞—Ü–∏—è –ø–æ–ª—è –∏–≥—Ä–æ–∫–∞
            for (let i = 0; i < 100; i++) {
                const cell = document.getElementById(`player-${i}`);
                cell.style.cursor = 'default';
                
                // –£–¥–∞–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è —Ä–∞—Å—Å—Ç–∞–Ω–æ–≤–∫–∏
                cell.removeEventListener('click', () => placePlayerShip(i));
                cell.removeEventListener('mouseenter', () => showShipPreview(i));
                cell.removeEventListener('mouseleave', () => hideShipPreview(i));
            }
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é
            updateTurnIndicator();
            document.getElementById('ship-factory').classList.add('hidden');
        }
        
        // ==================== –ò–ì–†–û–í–û–ô –ü–†–û–¶–ï–°–° ====================
        
        function attackEnemy(index) {
            if (!gameActive) return;
            
            if (gameMode === 'multiplayer') {
                // –í –º—É–ª—å—Ç–∏–ø–ª–µ–µ—Ä–µ –ø—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–∞—à –ª–∏ —Ö–æ–¥
                if (!myTurn) {
                    showNotification('–°–µ–π—á–∞—Å –Ω–µ –≤–∞—à —Ö–æ–¥!', 'warning');
                    return;
                }
            } else {
                // –í –∏–≥—Ä–µ —Å –ò–ò –ø—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–∞—à –ª–∏ —Ö–æ–¥
                if (!playerTurn) {
                    showNotification('–°–µ–π—á–∞—Å —Ö–æ–¥ –ò–ò!', 'warning');
                    return;
                }
            }
            
            const cell = document.getElementById(`enemy-${index}`);
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞, –Ω–µ —Å—Ç—Ä–µ–ª—è–ª–∏ –ª–∏ —É–∂–µ —Å—é–¥–∞
            if (cell.classList.contains('hit') || cell.classList.contains('miss')) {
                showNotification('–í—ã —É–∂–µ —Å—Ç—Ä–µ–ª—è–ª–∏ –≤ —ç—Ç—É –∫–ª–µ—Ç–∫—É!', 'warning');
                return;
            }
            
            movesCount++;
            playerShots++;
            
            if (gameMode === 'multiplayer') {
                // –í –º—É–ª—å—Ç–∏–ø–ª–µ–µ—Ä–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º —Ö–æ–¥ —Å–µ—Ä–≤–µ—Ä—É
                socket.emit('makeMove', { index: index });
                myTurn = false;
                updateTurnIndicator();
                gameStatus.textContent = '–í–∞—à —Ö–æ–¥ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω...';
            } else {
                // –í –∏–≥—Ä–µ —Å –ò–ò –ø—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ–ø–∞–¥–∞–Ω–∏–µ
                const shipId = enemyGrid[index];
                if (shipId) {
                    // –ü–æ–ø–∞–¥–∞–Ω–∏–µ
                    cell.classList.add('hit');
                    playerHits++;
                    
                    const ship = enemyShips.get(shipId);
                    ship.health--;
                    
                    // –ü—Ä–æ–≤–µ—Ä–∫–∞, —É–±–∏—Ç –ª–∏ –∫–æ—Ä–∞–±–ª—å
                    if (ship.health === 0) {
                        markAroundShip(ship.cells, 'enemy');
                        gameStatus.textContent = 'üíÄ –ö–û–†–ê–ë–õ–¨ –ò–ò –£–ë–ò–¢! –ü—Ä–æ–¥–æ–ª–∂–∞–π—Ç–µ –∞—Ç–∞–∫—É!';
                    } else {
                        gameStatus.textContent = 'üéØ –ü–û–ü–ê–î–ê–ù–ò–ï! –ü—Ä–æ–¥–æ–ª–∂–∞–π—Ç–µ –∞—Ç–∞–∫—É!';
                    }
                    
                    // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–±–µ–¥—ã
                    if (checkAIDefeat()) {
                        endGame(true);
                        return;
                    }
                    
                    // –ü—Ä–∏ –ø–æ–ø–∞–¥–∞–Ω–∏–∏ —Ö–æ–¥ –æ—Å—Ç–∞–µ—Ç—Å—è —É –∏–≥—Ä–æ–∫–∞
                    // –ò–ò –Ω–µ —Ö–æ–¥–∏—Ç
                } else {
                    // –ü—Ä–æ–º–∞—Ö
                    cell.classList.add('miss');
                    playerTurn = false;
                    gameStatus.textContent = 'üåÄ –ü–†–û–ú–ê–•! –•–æ–¥ –ò–ò...';
                    
                    // –•–æ–¥ –ò–ò
                    setTimeout(() => aiMakeMove(), 1000);
                }
            }
            
            updateGameInfo();
        }
        
        // ==================== –õ–û–ì–ò–ö–ê –ò–ò ====================
        
        function generateAIShips() {
            enemyGrid = Array(100).fill(null);
            enemyShips.clear();
            
            const shipSizes = [4, 3, 3, 2, 2, 2, 1, 1, 1, 1];
            
            shipSizes.forEach(size => {
                let placed = false;
                let attempts = 0;
                
                while (!placed && attempts < 1000) {
                    attempts++;
                    const randomIndex = Math.floor(Math.random() * 100);
                    const randomVertical = Math.random() < 0.5;
                    
                    const coords = getShipCoordinates(randomIndex, size, randomVertical);
                    if (coords && canPlaceAIShip(coords)) {
                        const shipId = `ai-ship-${Date.now()}-${size}`;
                        enemyShips.set(shipId, {
                            size: size,
                            cells: coords,
                            health: size
                        });
                        
                        coords.forEach(coord => {
                            enemyGrid[coord] = shipId;
                        });
                        
                        placed = true;
                    }
                }
            });
        }
        
        function canPlaceAIShip(coords) {
            for (const coord of coords) {
                const row = Math.floor(coord / 10);
                const col = coord % 10;
                
                // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–∞–º–æ–π –∫–ª–µ—Ç–∫–∏
                if (enemyGrid[coord] !== null) return false;
                
                // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Å–µ–¥–Ω–∏—Ö –∫–ª–µ—Ç–æ–∫
                for (let dr = -1; dr <= 1; dr++) {
                    for (let dc = -1; dc <= 1; dc++) {
                        const nr = row + dr;
                        const nc = col + dc;
                        
                        if (nr >= 0 && nr < 10 && nc >= 0 && nc < 10) {
                            const neighborIndex = nr * 10 + nc;
                            if (enemyGrid[neighborIndex] !== null) return false;
                        }
                    }
                }
            }
            
            return true;
        }
        
        function aiMakeMove() {
            if (!gameActive || playerTurn) return;
            
            let targetIndex;
            
            // –í—ã–±–æ—Ä —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —É—Ä–æ–≤–Ω—è —Å–ª–æ–∂–Ω–æ—Å—Ç–∏
            switch (aiLevel) {
                case 'easy':
                    targetIndex = getRandomAIMove();
                    break;
                case 'medium':
                    targetIndex = getMediumAIMove();
                    break;
                case 'hard':
                    targetIndex = getHardAIMove();
                    break;
            }
            
            executeAIMove(targetIndex);
        }
        
        function getRandomAIMove() {
            let availableCells = [];
            
            for (let i = 0; i < 100; i++) {
                const cell = document.getElementById(`player-${i}`);
                if (!cell.classList.contains('hit') && !cell.classList.contains('miss')) {
                    availableCells.push(i);
                }
            }
            
            if (availableCells.length === 0) return null;
            
            return availableCells[Math.floor(Math.random() * availableCells.length)];
        }
        
        function getMediumAIMove() {
            if (aiMemory.lastHit !== null && aiMemory.huntMode) {
                // –ü—ã—Ç–∞–µ–º—Å—è –Ω–∞–π—Ç–∏ —Å–æ—Å–µ–¥–Ω–∏–µ –∫–ª–µ—Ç–∫–∏
                const directions = [
                    { dr: -1, dc: 0 }, // –≤–≤–µ—Ä—Ö
                    { dr: 1, dc: 0 },  // –≤–Ω–∏–∑
                    { dr: 0, dc: -1 }, // –≤–ª–µ–≤–æ
                    { dr: 0, dc: 1 }   // –≤–ø—Ä–∞–≤–æ
                ];
                
                // –ï—Å–ª–∏ –µ—Å—Ç—å –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ, –ø—Ä–æ–¥–æ–ª–∂–∞–µ–º –≤ –Ω–µ–º
                if (aiMemory.hitDirection !== null) {
                    const dir = directions[aiMemory.hitDirection];
                    const row = Math.floor(aiMemory.lastHit / 10);
                    const col = aiMemory.lastHit % 10;
                    const nr = row + dir.dr;
                    const nc = col + dir.dc;
                    
                    if (nr >= 0 && nr < 10 && nc >= 0 && nc < 10) {
                        const nextIndex = nr * 10 + nc;
                        const cell = document.getElementById(`player-${nextIndex}`);
                        
                        if (!cell.classList.contains('hit') && !cell.classList.contains('miss')) {
                            return nextIndex;
                        }
                    }
                    
                    // –ï—Å–ª–∏ –Ω–µ –º–æ–∂–µ–º –ø—Ä–æ–¥–æ–ª–∂–∞—Ç—å –≤ —ç—Ç–æ–º –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–∏, —Å–±—Ä–∞—Å—ã–≤–∞–µ–º
                    aiMemory.hitDirection = null;
                }
                
                // –ò—â–µ–º –Ω–æ–≤–æ–µ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ
                for (let i = 0; i < directions.length; i++) {
                    const dir = directions[i];
                    const row = Math.floor(aiMemory.lastHit / 10);
                    const col = aiMemory.lastHit % 10;
                    const nr = row + dir.dr;
                    const nc = col + dir.dc;
                    
                    if (nr >= 0 && nr < 10 && nc >= 0 && nc < 10) {
                        const nextIndex = nr * 10 + nc;
                        const cell = document.getElementById(`player-${nextIndex}`);
                        
                        if (!cell.classList.contains('hit') && !cell.classList.contains('miss')) {
                            aiMemory.hitDirection = i;
                            return nextIndex;
                        }
                    }
                }
                
                // –ï—Å–ª–∏ –Ω–µ –Ω–∞—à–ª–∏ –ø–æ–¥—Ö–æ–¥—è—â–∏—Ö —Å–æ—Å–µ–¥–µ–π, —Å–±—Ä–∞—Å—ã–≤–∞–µ–º —Ä–µ–∂–∏–º –æ—Ö–æ—Ç—ã
                aiMemory.huntMode = false;
                aiMemory.lastHit = null;
            }
            
            return getRandomAIMove();
        }
        
        function getHardAIMove() {
            // –î–ª—è —Å–ª–æ–∂–Ω–æ–≥–æ —É—Ä–æ–≤–Ω—è –∏—Å–ø–æ–ª—å–∑—É–µ–º —Å—Ç—Ä–∞—Ç–µ–≥–∏—é –æ—Ö–æ—Ç—ã
            if (aiMemory.lastHit !== null && aiMemory.huntMode) {
                const lastHit = aiMemory.lastHit;
                const row = Math.floor(lastHit / 10);
                const col = lastHit % 10;
                
                // –ü—Ä–æ–±—É–µ–º –≤—Å–µ 4 –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è
                const directions = [
                    { dr: -1, dc: 0 }, // –≤–≤–µ—Ä—Ö
                    { dr: 1, dc: 0 },  // –≤–Ω–∏–∑
                    { dr: 0, dc: -1 }, // –≤–ª–µ–≤–æ
                    { dr: 0, dc: 1 }   // –≤–ø—Ä–∞–≤–æ
                ];
                
                // –ï—Å–ª–∏ –µ—Å—Ç—å –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ, –ø—Ä–æ–¥–æ–ª–∂–∞–µ–º –≤ –Ω–µ–º
                if (aiMemory.hitDirection !== null) {
                    const dir = directions[aiMemory.hitDirection];
                    let currentRow = row;
                    let currentCol = col;
                    
                    // –ò–¥–µ–º –≤ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–∏ –¥–æ —É–ø–æ—Ä–∞
                    while (true) {
                        currentRow += dir.dr;
                        currentCol += dir.dc;
                        
                        if (currentRow < 0 || currentRow >= 10 || currentCol < 0 || currentCol >= 10) {
                            break;
                        }
                        
                        const index = currentRow * 10 + currentCol;
                        const cell = document.getElementById(`player-${index}`);
                        
                        if (cell.classList.contains('miss')) {
                            break;
                        }
                        
                        if (!cell.classList.contains('hit')) {
                            return index;
                        }
                    }
                }
                
                // –ò—â–µ–º –Ω–æ–≤–æ–µ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ
                for (let i = 0; i < directions.length; i++) {
                    const dir = directions[i];
                    const nr = row + dir.dr;
                    const nc = col + dir.dc;
                    
                    if (nr >= 0 && nr < 10 && nc >= 0 && nc < 10) {
                        const index = nr * 10 + nc;
                        const cell = document.getElementById(`player-${index}`);
                        
                        if (!cell.classList.contains('hit') && !cell.classList.contains('miss')) {
                            aiMemory.hitDirection = i;
                            return index;
                        }
                    }
                }
            }
            
            return getRandomAIMove();
        }
        
        function executeAIMove(index) {
            if (index === null || index === undefined) return;
            
            const cell = document.getElementById(`player-${index}`);
            
            // –ó–∞–ø–æ–º–∏–Ω–∞–µ–º –ø–æ–ø—ã—Ç–∫—É
            aiMemory.triedCells.add(index);
            movesCount++;
            aiShots++;
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–ø–∞–¥–∞–Ω–∏—è
            const shipId = playerGrid[index];
            if (shipId) {
                // –ü–æ–ø–∞–¥–∞–Ω–∏–µ
                cell.classList.add('hit');
                aiHits++;
                
                const ship = playerShips.get(shipId);
                ship.health--;
                
                // –î–ª—è —Å–ª–æ–∂–Ω–æ–≥–æ –ò–ò: –∞–∫—Ç–∏–≤–∏—Ä—É–µ–º —Ä–µ–∂–∏–º –æ—Ö–æ—Ç—ã
                if (aiLevel === 'hard' || aiLevel === 'medium') {
                    aiMemory.huntMode = true;
                    aiMemory.lastHit = index;
                }
                
                // –ü—Ä–æ–≤–µ—Ä–∫–∞, —É–±–∏—Ç –ª–∏ –∫–æ—Ä–∞–±–ª—å
                if (ship.health === 0) {
                    markAroundShip(ship.cells, 'player');
                    
                    // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Ä–µ–∂–∏–º –æ—Ö–æ—Ç—ã –ø—Ä–∏ —É–±–∏–π—Å—Ç–≤–µ –∫–æ—Ä–∞–±–ª—è
                    aiMemory.huntMode = false;
                    aiMemory.lastHit = null;
                    aiMemory.hitDirection = null;
                    
                    gameStatus.textContent = 'üíî –í–∞—à –∫–æ—Ä–∞–±–ª—å —É–Ω–∏—á—Ç–æ–∂–µ–Ω! –•–æ–¥ –ò–ò –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç—Å—è...';
                } else {
                    gameStatus.textContent = 'üí• –ü–æ–ø–∞–¥–∞–Ω–∏–µ –ø–æ –≤–∞—à–µ–º—É –∫–æ—Ä–∞–±–ª—é! –•–æ–¥ –ò–ò –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç—Å—è...';
                }
                
                // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Ä–∞–∂–µ–Ω–∏—è
                if (checkPlayerDefeat()) {
                    endGame(false);
                    return;
                }
                
                // –ò–ò –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç —Ö–æ–¥ –ø—Ä–∏ –ø–æ–ø–∞–¥–∞–Ω–∏–∏
                setTimeout(() => aiMakeMove(), 1000);
            } else {
                // –ü—Ä–æ–º–∞—Ö
                cell.classList.add('miss');
                playerTurn = true;
                updateTurnIndicator();
                gameStatus.textContent = 'üåÄ –ò–ò –ø—Ä–æ–º–∞—Ö–Ω—É–ª—Å—è! –í–∞—à —Ö–æ–¥.';
            }
            
            updateGameInfo();
        }
        
        function markAroundShip(coords, gridType) {
            const marked = new Set();
            
            coords.forEach(coord => {
                const row = Math.floor(coord / 10);
                const col = coord % 10;
                
                // –ü–æ–º–µ—á–∞–µ–º –≤—Å–µ —Å–æ—Å–µ–¥–Ω–∏–µ –∫–ª–µ—Ç–∫–∏
                for (let dr = -1; dr <= 1; dr++) {
                    for (let dc = -1; dc <= 1; dc++) {
                        const nr = row + dr;
                        const nc = col + dc;
                        
                        if (nr >= 0 && nr < 10 && nc >= 0 && nc < 10) {
                            const index = nr * 10 + nc;
                            
                            if (!coords.includes(index) && !marked.has(index)) {
                                marked.add(index);
                                const cell = document.getElementById(`${gridType}-${index}`);
                                
                                if (!cell.classList.contains('hit')) {
                                    cell.classList.add('miss');
                                }
                            }
                        }
                    }
                }
            });
        }
        
        function checkPlayerDefeat() {
            for (const ship of playerShips.values()) {
                if (ship.health > 0) return false;
            }
            return true;
        }
        
        function checkAIDefeat() {
            for (const ship of enemyShips.values()) {
                if (ship.health > 0) return false;
            }
            return true;
        }
        
        function checkEnemyDefeat() {
            // –î–ª—è –º—É–ª—å—Ç–∏–ø–ª–µ–µ—Ä–∞ - –ø—Ä–æ–≤–µ—Ä—è–µ–º, –≤—Å–µ –ª–∏ –∫–æ—Ä–∞–±–ª–∏ –ø—Ä–æ—Ç–∏–≤–Ω–∏–∫–∞ —É–Ω–∏—á—Ç–æ–∂–µ–Ω—ã
            // –í —Ä–µ–∞–ª—å–Ω–æ–π –∏–≥—Ä–µ —Å–µ—Ä–≤–µ—Ä –¥–æ–ª–∂–µ–Ω –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å —ç—Ç–æ
            return false;
        }
        
        function endGame(playerWon) {
            gameActive = false;
            playerTurn = false;
            myTurn = false;
            
            // –ë–ª–æ–∫–∏—Ä—É–µ–º –≤—Å–µ –∫–ª–µ—Ç–∫–∏
            for (let i = 0; i < 100; i++) {
                document.getElementById(`enemy-${i}`).style.cursor = 'default';
            }
            
            if (playerWon) {
                gameStatus.textContent = 'üéâ –ü–û–ë–ï–î–ê!';
                gameStatus.style.borderColor = 'var(--neon-green)';
            } else {
                gameStatus.textContent = 'üíÄ –ü–û–†–ê–ñ–ï–ù–ò–ï!';
                gameStatus.style.borderColor = 'var(--neon-red)';
            }
            
            // –í –º—É–ª—å—Ç–∏–ø–ª–µ–µ—Ä–µ —Å–æ–æ–±—â–∞–µ–º —Å–µ—Ä–≤–µ—Ä—É –æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ –∏–≥—Ä—ã
            if (gameMode === 'multiplayer' && socket) {
                socket.emit('gameOver', { winner: playerWon });
            }
        }
        
        function updateGameInfo() {
            // –•–æ–¥—ã
            document.getElementById('hits-count').textContent = `${playerHits}/${playerShots}`;
            
            // –û—Å—Ç–∞–≤—à–∏–µ—Å—è –∫–æ—Ä–∞–±–ª–∏
            let playerShipsLeft = 0;
            let enemyShipsLeft = 0;
            
            for (const ship of playerShips.values()) {
                if (ship.health > 0) playerShipsLeft++;
            }
            
            if (gameMode === 'ai') {
                for (const ship of enemyShips.values()) {
                    if (ship.health > 0) enemyShipsLeft++;
                }
            } else {
                // –í –º—É–ª—å—Ç–∏–ø–ª–µ–µ—Ä–µ —Å–µ—Ä–≤–µ—Ä –¥–æ–ª–∂–µ–Ω –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è—Ç—å —ç—Ç—É –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é
                enemyShipsLeft = 10 - playerHits;
            }
            
            document.getElementById('ships-count').textContent = `${playerShipsLeft}/${enemyShipsLeft}`;
        }
        
        function updateTurnIndicator() {
            let turnText = '';
            
            if (gameMode === 'ai') {
                turnText = playerTurn ? '–í–∞—à —Ö–æ–¥' : '–•–æ–¥ –ò–ò';
            } else if (gameMode === 'multiplayer') {
                turnText = myTurn ? '–í–∞—à —Ö–æ–¥' : '–•–æ–¥ –ø—Ä–æ—Ç–∏–≤–Ω–∏–∫–∞';
            }
            
            document.getElementById('turn-indicator').textContent = turnText;
        }
        
        function surrender() {
            if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —Å–¥–∞—Ç—å—Å—è?')) {
                endGame(false);
            }
        }
        
        function restartGame() {
            if (gameMode === 'multiplayer' && gameActive) {
                if (!confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã? –≠—Ç–æ –∑–∞–≤–µ—Ä—à–∏—Ç —Ç–µ–∫—É—â—É—é –∏–≥—Ä—É.')) return;
                if (socket) socket.emit('leaveGame');
            }
            
            location.reload();
        }
        
        // ==================== –ó–ê–ü–£–°–ö ====================
        
        window.addEventListener('DOMContentLoaded', () => {
            console.log('–ú–æ—Ä—Å–∫–æ–π –ë–æ–π –∑–∞–≥—Ä—É–∂–µ–Ω!');
            
            // –î–æ–±–∞–≤–ª—è–µ–º —Å—Ç–∏–ª–∏ –¥–ª—è –∞–Ω–∏–º–∞—Ü–∏–π
            const style = document.createElement('style');
            style.textContent = `
                @keyframes fadeIn {
                    from { opacity: 0; transform: translateY(-10px); }
                    to { opacity: 1; transform: translateY(0); }
                }
                @keyframes fadeOut {
                    from { opacity: 1; transform: translateY(0); }
                    to { opacity: 0; transform: translateY(-10px); }
                }
                .invalid-preview {
                    background: rgba(244, 67, 54, 0.5) !important;
                    border: 1px dashed #F44336 !important;
                }
            `;
            document.head.appendChild(style);
            
            // –ó–∞–≥—Ä—É–∑–∫–∞ –∏–º–µ–Ω–∏ –∏–≥—Ä–æ–∫–∞
            const savedName = localStorage.getItem('playerName');
            if (savedName) {
                playerName = savedName;
            } else {
                localStorage.setItem('playerName', playerName);
            }
        });
        
        // –≠–∫—Å–ø–æ—Ä—Ç —Ñ—É–Ω–∫—Ü–∏–π –¥–ª—è HTML
        window.selectGameMode = selectGameMode;
        window.closeModal = closeModal;
        window.showCreateLobby = showCreateLobby;
        window.showLobbyList = showLobbyList;
        window.showDirectJoin = showDirectJoin;
        window.showMultiplayerMenu = showMultiplayerMenu;
        window.createLobby = createLobby;
        window.refreshLobbyList = refreshLobbyList;
        window.joinLobby = joinLobby;
        window.joinDirectLobby = joinDirectLobby;
        window.toggleReady = toggleReady;
        window.copyLobbyId = copyLobbyId;
        window.leaveLobby = leaveLobby;
        window.startAIGame = startAIGame;
        window.rotateShip = rotateShip;
        window.clearShips = clearShips;
        window.randomPlacement = randomPlacement;
        window.startBattle = startBattle;
        window.aiMakeMove = aiMakeMove;
        window.surrender = surrender;
        window.restartGame = restartGame;
    </script>
</body>
</html>
