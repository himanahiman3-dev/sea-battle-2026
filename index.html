<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Sea Battle Neon 2026</title>
    <link href="fonts.googleapis.com" rel="stylesheet">
    <style>
        :root { --neon-blue: #00f2ff; --neon-red: #ff0055; --bg-dark: #020b1a; }
        body { background: var(--bg-dark); color: var(--neon-blue); font-family: 'Orbitron', sans-serif; display: flex; flex-direction: column; align-items: center; margin: 0; min-height: 100vh; overflow-x: hidden; }
        
        /* –ì–õ–ê–í–ù–û–ï –ú–ï–ù–Æ */
        #main-menu { display: flex; flex-direction: column; gap: 20px; padding-top: 50px; text-align: center; }
        .menu-card { background: rgba(0, 242, 255, 0.05); padding: 25px; border: 2px solid var(--neon-blue); width: 350px; }
        .hidden { display: none !important; }

        /* –ò–ì–†–û–í–û–ô –≠–ö–†–ê–ù */
        #game-screen { width: 100%; display: flex; flex-direction: column; align-items: center; }
        .game-container { display: flex; gap: 40px; padding: 20px; flex-wrap: wrap; justify-content: center; }
        .grid { display: grid; grid-template-columns: repeat(10, 40px); grid-template-rows: repeat(10, 40px); gap: 2px; background: rgba(0, 242, 255, 0.1); border: 3px solid var(--neon-blue); }
        .cell { width: 40px; height: 40px; background: rgba(2, 11, 26, 0.8); cursor: pointer; display: flex; align-items: center; justify-content: center; font-size: 20px; }
        
        /* –°–û–°–¢–û–Ø–ù–ò–Ø –ö–õ–ï–¢–û–ö */
        .ship { background: var(--neon-blue) !important; box-shadow: inset 0 0 10px #000; }
        .hit { background: rgba(255, 0, 85, 0.3) !important; animation: shake 0.2s; }
        .hit::after { content: "üí•"; }
        .miss::after { content: "‚Ä¢"; color: var(--neon-blue); font-size: 30px; }
        .radar-scan { background: rgba(255, 165, 0, 0.5) !important; }

        /* –ö–ù–û–ü–ö–ò */
        .btn { padding: 10px; border: 2px solid var(--neon-blue); color: var(--neon-blue); cursor: pointer; }
        .super-weapons { margin-top: 10px; display: flex; gap: 10px; justify-content: center; }
        .super-weapon-btn { background: #ff9d00; color: black; border-color: #ff9d00; }

        #status-text { height: 70px; font-size: 1.3rem; text-align: center; margin-top: 20px; }
        .kill-msg { color: var(--neon-red); font-weight: bold; }
    </style>
</head>
<body>

    <!-- –ì–õ–ê–í–ù–û–ï –ú–ï–ù–Æ -->
    <div id="main-menu">
        <h1>SEA BATTLE <span style="color:var(--neon-red)">NEON</span></h1>
        <div class="menu-card">
            <h3>–ú–£–õ–¨–¢–ò–ü–õ–ï–ï–†</h3>
            <input type="text" id="room-id" placeholder="ID –ö–û–ú–ù–ê–¢–´">
            <input type="password" id="room-pass" placeholder="–ü–ê–†–û–õ–¨">
            <button class="btn" onclick="startMultiplayer()">–°–û–ó–î–ê–¢–¨ / –í–û–ô–¢–ò</button>
        </div>
        <div class="menu-card">
            <h3>–û–î–ò–ù–û–ß–ù–ê–Ø –ò–ì–†–ê</h3>
            <button class="btn" onclick="startAI('easy')">–õ–ï–ì–ö–ò–ô –ò–ò</button>
            <button class="btn" onclick="startAI('hard')">–°–õ–û–ñ–ù–´–ô –ò–ò</button>
        </div>
    </div>

    <!-- –ò–ì–†–û–í–û–ô –≠–ö–†–ê–ù -->
    <div id="game-screen" class="hidden">
        <div id="status-text">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
        
        <div class="super-weapons">
            <button id="btn-airstrike" class="btn super-weapon-btn" onclick="activateSuperWeapon('airstrike')">–ê–≤–∏–∞—É–¥–∞—Ä (1)</button>
            <button id="btn-radar" class="btn super-weapon-btn" onclick="activateSuperWeapon('radar')">–†–∞–¥–∞—Ä (1)</button>
        </div>
        
        <div class="game-container">
            <div>
                <p>–í–ê–® –§–õ–û–¢ (–ü–í–û –≤ —Ä—è–¥–∞—Ö 4 –∏ 5)</p>
                <div id="my-grid" class="grid"></div>
            </div>
            <div id="enemy-box" class="hidden">
                <p>–†–ê–î–ê–† –í–†–ê–ì–ê</p>
                <div id="enemy-grid" class="grid"></div>
            </div>
        </div>
    </div>

    <script src="/socket.io/socket.io.js"></script>
    <script>
        const socket = io();
        const sounds = { bg: new Audio('bg_music.mp3'), shot: new Audio('shot.mp3'), hit: new Audio('hit.mp3'), miss: new Audio('miss.mp3') };
        sounds.bg.loop = true;

        let isAI = false, gameActive = false, canMove = false;
        let myShipsMap = Array(100).fill(null), myShipsHealth = {};
        let enemyShipsMap = Array(100).fill(null), enemyShipsHealth = {};
        let playerHits = 0, enemyHits = 0, WIN_SCORE = 20;

        let availableWeapons = { airstrike: 1, radar: 1 };
        let activeWeapon = null;
        // –ü–í–û –∞–∫—Ç–∏–≤–Ω—ã –≤ —Ä—è–¥–∞—Ö 4 –∏ 5 (–∏–Ω–¥–µ–∫—Å—ã 40-59)
        const PVO_ROWS = [4, 5]; 

        const myGrid = document.getElementById('my-grid');
        const enemyGrid = document.getElementById('enemy-grid');
        const status = document.getElementById('status-text');

        for (let i = 0; i < 100; i++) {
            const mCell = document.createElement('div'); mCell.className = 'cell'; mCell.id = `my-${i}`; myGrid.appendChild(mCell);
            const eCell = document.createElement('div'); eCell.className = 'cell'; eCell.id = `enemy-${i}`; eCell.onclick = () => fire(i); enemyGrid.appendChild(eCell);
        }

        function startMultiplayer() { /* ... (–ö–æ–¥ –∏–∑ –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ –æ—Ç–≤–µ—Ç–∞) ... */ }
        function startAI(level) { /* ... (–ö–æ–¥ –∏–∑ –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ –æ—Ç–≤–µ—Ç–∞) ... */ }
        function enterGame() {
            document.getElementById('main-menu').classList.add('hidden');
            document.getElementById('game-screen').classList.remove('hidden');
            sounds.bg.play().catch(()=>{});
        }
        function fire(idx) {
            if (!gameActive || !canMove) return;
            if (activeWeapon) {
                useSuperWeapon(idx);
            } else {
                const cell = document.getElementById(`enemy-${idx}`);
                if (cell.classList.contains('hit') || cell.classList.contains('miss') || cell.classList.contains('radar-scan')) return;
                sounds.shot.currentTime = 0; sounds.shot.play();
                if (isAI) handleAIShot(idx);
                else { canMove = false; socket.emit('makeMove', { index: idx }); }
            }
        }
        function handleAIShot(idx) { /* ... (–ö–æ–¥ –∏–∑ –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ –æ—Ç–≤–µ—Ç–∞) ... */ }
        function aiMove() { /* ... (–ö–æ–¥ –∏–∑ –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ –æ—Ç–≤–µ—Ç–∞) ... */ }


        // --- –°–£–ü–ï–†–û–†–£–ñ–ò–ï –õ–û–ì–ò–ö–ê ---
        function activateSuperWeapon(weaponType) {
            if (!gameActive || availableWeapons[weaponType] === 0 || activeWeapon === weaponType) return;
            activeWeapon = weaponType;
            status.innerText = `–í—ã–±–µ—Ä–∏—Ç–µ –∫–≤–∞–¥—Ä–∞—Ç –¥–ª—è ${weaponType === 'airstrike' ? '–∞–≤–∏–∞—É–¥–∞—Ä–∞ 1x4' : '—Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è —Ä–∞–¥–∞—Ä–æ–º 3x3'}.`;
            // –ó–¥–µ—Å—å –Ω—É–∂–Ω–∞ –ª–æ–≥–∏–∫–∞ –ø–æ–¥—Å–≤–µ—Ç–∫–∏ –ø–æ–ª—è –ø—Ä–∏ –Ω–∞–≤–µ–¥–µ–Ω–∏–∏, –∫–∞–∫ –ø—Ä–∏ —Ä–∞—Å—Å—Ç–∞–Ω–æ–≤–∫–µ
        }

        function useSuperWeapon(idx) {
            if (activeWeapon === 'airstrike') {
                // ... –õ–æ–≥–∏–∫–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è 1x4 –æ–±–ª–∞—Å—Ç–∏ ...
                if (isAI) {
                    // –ò–ò –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∞–≤–∏–∞—É–¥–∞—Ä–∞
                } else {
                    socket.emit('useAirstrike', { index: idx });
                    availableWeapons.airstrike--;
                    document.getElementById('btn-airstrike').disabled = true;
                }
            } else if (activeWeapon === 'radar') {
                 // ... –õ–æ–≥–∏–∫–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è 3x3 –æ–±–ª–∞—Å—Ç–∏ ...
                if (isAI) {
                    // –ò–ò –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Ä–∞–¥–∞—Ä–∞
                } else {
                    socket.emit('useRadar', { index: idx });
                    availableWeapons.radar--;
                    document.getElementById('btn-radar').disabled = true;
                }
            }
            activeWeapon = null;
            canMove = false; // –•–æ–¥ –∑–∞–∫–∞–Ω—á–∏–≤–∞–µ—Ç—Å—è –ø–æ—Å–ª–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è —Å—É–ø–µ—Ä–æ—Ä—É–∂–∏—è
        }

        // --- –°–ï–¢–ï–í–´–ï –û–ë–†–ê–ë–û–¢–ß–ò–ö–ò –°–£–ü–ï–†–û–†–£–ñ–ò–Ø ---
        socket.on('enemyAirstrike', (data) => {
            // –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –≤—Ä–∞–∂–µ—Å–∫–æ–≥–æ –∞–≤–∏–∞—É–¥–∞—Ä–∞
            const targets = []; // ... –ª–æ–≥–∏–∫–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è 1x4 –∑–æ–Ω—ã –∏–∑ data.index ...
            let pvoActivated = false;
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ü–í–û
            for (const targetIdx of targets) {
                if (PVO_ROWS.includes(Math.floor(targetIdx / 10))) {
                    pvoActivated = true;
                    alert("–í–ê–®–ï –ü–í–û –°–ë–ò–õ–û –ê–í–ò–ê–£–î–ê–† –ü–†–û–¢–ò–í–ù–ò–ö–ê!");
                    break;
                }
            }

            const results = targets.map(idx => {
                const isHit = !pvoActivated && !!myShipsMap[idx];
                // ... –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ UI (hit/miss) ...
                return { index: idx, isHit };
            });
            socket.emit('airstrikeResult', { results });
        });

        socket.on('updateAirstrikeResult', (data) => {
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ UI –∏–≥—Ä–æ–∫–∞, –∫–æ—Ç–æ—Ä—ã–π –ø—Ä–∏–º–µ–Ω–∏–ª –∞–≤–∏–∞—É–¥–∞—Ä, –Ω–∞ –æ—Å–Ω–æ–≤–µ data.results
            canMove = true;
        });

        socket.on('enemyRadar', (data) => {
             // –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –≤—Ä–∞–∂–µ—Å–∫–æ–≥–æ —Ä–∞–¥–∞—Ä–∞
             const targets = []; // ... –ª–æ–≥–∏–∫–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è 3x3 –∑–æ–Ω—ã –∏–∑ data.index ...
             let found = false;
             for (const targetIdx of targets) {
                 if (!!myShipsMap[targetIdx]) {
                     found = true;
                     break;
                 }
             }
             // PVO –Ω–µ —Å–±–∏–≤–∞–µ—Ç —Ä–∞–¥–∞—Ä
             socket.emit('radarResult', { found });
        });

        socket.on('updateRadarResult', (data) => {
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ UI –∏–≥—Ä–æ–∫–∞, –∫–æ—Ç–æ—Ä—ã–π –ø—Ä–∏–º–µ–Ω–∏–ª —Ä–∞–¥–∞—Ä
            if (data.found) alert("–†–ê–î–ê–† –ß–¢–û-–¢–û –ù–ê–®–ï–õ –í –°–ï–ö–¢–û–†–ï!");
            else alert("–°–ï–ö–¢–û–† –ß–ò–°–¢.");
            canMove = true;
        });
        
        // ... (–æ—Å—Ç–∞–ª—å–Ω—ã–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ socket.on: waiting, errorMsg, enemyDisconnected, gameStart, enemyMove, updateResult) ...

    </script>
</body>
</html>
