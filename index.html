<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ú–æ—Ä—Å–∫–æ–π –ë–æ–π - –ú—É–ª—å—Ç–∏–ø–ª–µ–µ—Ä</title>
    <style>
        :root {
            --primary: #1a237e;
            --secondary: #283593;
            --accent: #536dfe;
            --neon-blue: #00b0ff;
            --neon-red: #ff1744;
            --neon-green: #00e676;
            --neon-yellow: #ffeb3b;
            --neon-purple: #e040fb;
            --text: #e8eaf6;
            --grid-bg: #0d47a1;
            --cell-size: 35px;
            --ai-easy: #4CAF50;
            --ai-medium: #FF9800;
            --ai-hard: #F44336;
            --lobby-bg: #0d1b36;
            --card-bg: rgba(30, 47, 153, 0.7);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #0c2461, #1e3799);
            color: var(--text);
            min-height: 100vh;
            padding: 20px;
            overflow-x: hidden;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .hidden {
            display: none !important;
        }

        /* –ó–∞–≥–æ–ª–æ–≤–æ–∫ */
        .header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 15px;
            border: 2px solid var(--neon-blue);
            box-shadow: 0 0 20px rgba(0, 176, 255, 0.3);
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { box-shadow: 0 0 20px rgba(0, 176, 255, 0.3); }
            50% { box-shadow: 0 0 30px rgba(0, 176, 255, 0.6); }
            100% { box-shadow: 0 0 20px rgba(0, 176, 255, 0.3); }
        }

        h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            color: var(--neon-blue);
            text-shadow: 0 0 10px rgba(0, 176, 255, 0.5);
        }

        /* –ú–µ–Ω—é —Ä–µ–∂–∏–º–æ–≤ */
        .game-modes {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin: 30px 0;
            flex-wrap: wrap;
        }

        .mode-card {
            background: linear-gradient(145deg, var(--secondary), var(--primary));
            border: 2px solid var(--neon-blue);
            border-radius: 15px;
            padding: 30px;
            width: 300px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.3);
        }

        .mode-card:hover {
            transform: translateY(-10px);
            box-shadow: 0 15px 30px rgba(0, 176, 255, 0.4);
            border-color: var(--neon-green);
        }

        .mode-icon {
            font-size: 48px;
            margin-bottom: 15px;
        }

        .mode-title {
            font-size: 24px;
            margin-bottom: 10px;
            color: var(--neon-green);
        }

        .mode-desc {
            font-size: 14px;
            color: #BBDEFB;
            line-height: 1.5;
        }

        /* –ú–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞ */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            backdrop-filter: blur(5px);
        }

        .modal {
            background: linear-gradient(145deg, var(--lobby-bg), var(--primary));
            border: 2px solid var(--neon-blue);
            border-radius: 15px;
            padding: 30px;
            width: 90%;
            max-width: 500px;
            box-shadow: 0 20px 50px rgba(0, 176, 255, 0.3);
            animation: modal-appear 0.3s ease-out;
        }

        @keyframes modal-appear {
            from {
                opacity: 0;
                transform: translateY(-50px) scale(0.9);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--neon-blue);
        }

        .modal-title {
            font-size: 24px;
            color: var(--neon-green);
        }

        .close-btn {
            background: none;
            border: none;
            color: var(--neon-red);
            font-size: 24px;
            cursor: pointer;
            transition: transform 0.3s;
        }

        .close-btn:hover {
            transform: rotate(90deg);
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            color: var(--neon-yellow);
            font-weight: bold;
        }

        .form-input {
            width: 100%;
            padding: 12px 15px;
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid var(--accent);
            border-radius: 8px;
            color: white;
            font-size: 16px;
            transition: all 0.3s;
        }

        .form-input:focus {
            outline: none;
            border-color: var(--neon-blue);
            box-shadow: 0 0 15px rgba(0, 176, 255, 0.5);
        }

        .form-select {
            width: 100%;
            padding: 12px 15px;
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid var(--accent);
            border-radius: 8px;
            color: white;
            font-size: 16px;
            cursor: pointer;
        }

        .form-select option {
            background: var(--lobby-bg);
            color: white;
        }

        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 10px;
            margin: 15px 0;
        }

        .checkbox-group input[type="checkbox"] {
            width: 20px;
            height: 20px;
            cursor: pointer;
        }

        .checkbox-label {
            color: var(--text);
            cursor: pointer;
        }

        /* –ö–Ω–æ–ø–∫–∏ */
        .btn {
            background: linear-gradient(45deg, var(--accent), var(--neon-blue));
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            margin: 5px;
            text-transform: uppercase;
            letter-spacing: 1px;
            min-width: 150px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(83, 109, 254, 0.4);
        }

        .btn:disabled {
            background: #666;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .btn-success {
            background: linear-gradient(45deg, var(--neon-green), #00c853);
        }

        .btn-danger {
            background: linear-gradient(45deg, var(--neon-red), #D50000);
        }

        .btn-warning {
            background: linear-gradient(45deg, var(--neon-yellow), #FF9800);
        }

        .btn-group {
            display: flex;
            gap: 10px;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        /* –°–ø–∏—Å–æ–∫ –ª–æ–±–±–∏ */
        .lobby-list-container {
            max-height: 400px;
            overflow-y: auto;
            margin: 20px 0;
            border-radius: 10px;
            border: 2px solid var(--accent);
            background: rgba(0, 0, 0, 0.2);
        }

        .lobby-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
            padding: 15px;
        }

        .lobby-item {
            background: var(--card-bg);
            border: 1px solid var(--accent);
            border-radius: 10px;
            padding: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.3s;
            cursor: pointer;
        }

        .lobby-item:hover {
            background: rgba(83, 109, 254, 0.3);
            transform: translateX(5px);
            border-color: var(--neon-blue);
        }

        .lobby-item.selected {
            background: rgba(0, 230, 118, 0.2);
            border-color: var(--neon-green);
            box-shadow: 0 0 10px rgba(0, 230, 118, 0.3);
        }

        .lobby-info {
            flex: 1;
        }

        .lobby-name {
            font-size: 18px;
            font-weight: bold;
            color: var(--neon-yellow);
            margin-bottom: 5px;
        }

        .lobby-meta {
            display: flex;
            gap: 15px;
            font-size: 14px;
            color: #BBDEFB;
        }

        .lobby-status {
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
            text-transform: uppercase;
        }

        .status-waiting {
            background: rgba(255, 193, 7, 0.2);
            color: #FFC107;
        }

        .status-full {
            background: rgba(244, 67, 54, 0.2);
            color: #F44336;
        }

        .status-playing {
            background: rgba(76, 175, 80, 0.2);
            color: #4CAF50;
        }

        .password-badge {
            display: inline-flex;
            align-items: center;
            gap: 5px;
            padding: 3px 8px;
            background: rgba(156, 39, 176, 0.2);
            border-radius: 12px;
            color: #E040FB;
            font-size: 12px;
        }

        /* –ò–≥—Ä–æ–≤–æ–π —ç–∫—Ä–∞–Ω */
        .game-screen {
            background: rgba(13, 71, 161, 0.9);
            padding: 25px;
            border-radius: 15px;
            border: 2px solid var(--accent);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            margin-top: 20px;
        }

        .game-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding: 15px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 10px;
            border: 1px solid var(--neon-blue);
        }

        .info-item {
            text-align: center;
        }

        .info-label {
            font-size: 14px;
            color: var(--neon-green);
            margin-bottom: 5px;
        }

        .info-value {
            font-size: 24px;
            font-weight: bold;
            color: var(--neon-yellow);
        }

        /* –ò–≥—Ä–æ–≤—ã–µ –ø–æ–ª—è */
        .game-area {
            display: flex;
            justify-content: space-around;
            flex-wrap: wrap;
            gap: 30px;
            margin-bottom: 20px;
        }

        .grid-container {
            text-align: center;
            background: rgba(0, 0, 0, 0.2);
            padding: 15px;
            border-radius: 10px;
            border: 1px solid var(--accent);
        }

        .grid-title {
            margin-bottom: 15px;
            font-size: 1.3em;
            color: var(--neon-green);
            text-shadow: 0 0 5px rgba(0, 230, 118, 0.3);
            padding: 10px;
            border-bottom: 2px solid var(--neon-blue);
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(10, var(--cell-size));
            grid-template-rows: repeat(10, var(--cell-size));
            gap: 2px;
            background: rgba(0, 0, 0, 0.3);
            padding: 10px;
            border-radius: 8px;
            border: 2px solid var(--accent);
        }

        .cell {
            width: var(--cell-size);
            height: var(--cell-size);
            background: rgba(255, 255, 255, 0.1);
            border-radius: 3px;
            cursor: pointer;
            transition: all 0.2s;
            position: relative;
        }

        .cell:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: scale(1.05);
        }

        .cell.disabled {
            cursor: not-allowed;
            opacity: 0.7;
        }

        .cell.ship {
            background: linear-gradient(45deg, #4CAF50, #8BC34A);
            border: 1px solid #388E3C;
            box-shadow: inset 0 0 10px rgba(0, 0, 0, 0.3);
        }

        .cell.hit {
            background: linear-gradient(45deg, #F44336, #E53935);
            animation: hit 0.3s ease-out;
        }

        @keyframes hit {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }

        .cell.hit::after {
            content: 'üí•';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 18px;
            animation: fire 0.5s ease-out;
        }

        .cell.miss {
            background: rgba(33, 150, 243, 0.3);
        }

        .cell.miss::after {
            content: '‚Ä¢';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: #2196F3;
            font-size: 24px;
            opacity: 0.8;
        }

        /* –°—Ç–∞—Ç—É—Å –∏–≥—Ä—ã */
        .status {
            text-align: center;
            padding: 15px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            border: 1px solid var(--neon-blue);
            margin-top: 20px;
            min-height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2em;
            font-weight: bold;
            animation: status-glow 2s infinite alternate;
        }

        @keyframes status-glow {
            from { box-shadow: 0 0 10px rgba(0, 176, 255, 0.3); }
            to { box-shadow: 0 0 20px rgba(0, 176, 255, 0.6); }
        }

        /* –°–æ–æ–±—â–µ–Ω–∏—è —á–∞—Ç–∞ */
        .chat-container {
            margin-top: 20px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 10px;
            border: 1px solid var(--accent);
            overflow: hidden;
        }

        .chat-messages {
            height: 200px;
            overflow-y: auto;
            padding: 15px;
        }

        .chat-message {
            margin-bottom: 10px;
            padding: 8px 12px;
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.1);
        }

        .message-sender {
            font-weight: bold;
            color: var(--neon-yellow);
            margin-right: 10px;
        }

        .chat-input-container {
            display: flex;
            padding: 10px;
            border-top: 1px solid var(--accent);
            background: rgba(0, 0, 0, 0.3);
        }

        .chat-input {
            flex: 1;
            padding: 10px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid var(--accent);
            border-radius: 5px;
            color: white;
        }

        .chat-send {
            margin-left: 10px;
            padding: 10px 20px;
            background: var(--accent);
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }

        /* –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 20px;
            background: var(--card-bg);
            border-left: 4px solid var(--neon-blue);
            border-radius: 5px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            z-index: 1001;
            animation: slide-in 0.3s ease-out;
        }

        @keyframes slide-in {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        .notification-success {
            border-left-color: var(--neon-green);
        }

        .notification-error {
            border-left-color: var(--neon-red);
        }

        .notification-warning {
            border-left-color: var(--neon-yellow);
        }

        /* –ó–∞–≥—Ä—É–∑–∫–∞ */
        .loading {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 40px;
        }

        .spinner {
            width: 50px;
            height: 50px;
            border: 5px solid rgba(0, 176, 255, 0.3);
            border-top: 5px solid var(--neon-blue);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å */
        @media (max-width: 768px) {
            .game-area {
                flex-direction: column;
                align-items: center;
            }
            
            .grid {
                grid-template-columns: repeat(10, 30px);
                grid-template-rows: repeat(10, 30px);
            }
            
            .cell {
                width: 30px;
                height: 30px;
            }
            
            .mode-card {
                width: 100%;
                max-width: 300px;
            }
            
            .btn {
                padding: 10px 15px;
                min-width: 120px;
                font-size: 14px;
            }
        }

        @media (max-width: 480px) {
            .grid {
                grid-template-columns: repeat(10, 25px);
                grid-template-rows: repeat(10, 25px);
            }
            
            .cell {
                width: 25px;
                height: 25px;
            }
            
            .modal {
                padding: 20px;
                width: 95%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ -->
        <div class="header">
            <h1>‚öì –ú–æ—Ä—Å–∫–æ–π –ë–æ–π - –ú—É–ª—å—Ç–∏–ø–ª–µ–µ—Ä</h1>
            <p>–°—Ä–∞–∑–∏—Ç–µ—Å—å —Å –ò–ò –∏–ª–∏ –∏–≥—Ä–∞–π—Ç–µ —Å –¥—Ä—É–∑—å—è–º–∏ –æ–Ω–ª–∞–π–Ω!</p>
        </div>

        <!-- –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é -->
        <div id="main-menu" class="game-modes">
            <div class="mode-card" onclick="selectGameMode('ai')">
                <div class="mode-icon">ü§ñ</div>
                <div class="mode-title">–ò–≥—Ä–∞ —Å –ò–ò</div>
                <div class="mode-desc">
                    –°—Ä–∞–∑–∏—Ç–µ—Å—å —Å –∏—Å–∫—É—Å—Å—Ç–≤–µ–Ω–Ω—ã–º –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç–æ–º —Ç—Ä–µ—Ö —É—Ä–æ–≤–Ω–µ–π —Å–ª–æ–∂–Ω–æ—Å—Ç–∏
                </div>
            </div>
            
            <div class="mode-card" onclick="selectGameMode('multiplayer')">
                <div class="mode-icon">üë•</div>
                <div class="mode-title">–ò–≥—Ä–∞ —Å –¥—Ä—É–≥–æ–º</div>
                <div class="mode-desc">
                    –°–æ–∑–¥–∞–π—Ç–µ –ª–æ–±–±–∏ –∏–ª–∏ –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–∏—Ç–µ—Å—å –∫ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π –∏–≥—Ä–µ
                </div>
            </div>
            
            <div class="mode-card" onclick="showStats()">
                <div class="mode-icon">üìä</div>
                <div class="mode-title">–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</div>
                <div class="mode-desc">
                    –ü–æ—Å–º–æ—Ç—Ä–∏—Ç–µ –≤–∞—à—É —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –∏ —Ä–µ–∫–æ—Ä–¥—ã
                </div>
            </div>
        </div>

        <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –≤—ã–±–æ—Ä–∞ —É—Ä–æ–≤–Ω—è –ò–ò -->
        <div id="ai-modal" class="modal-overlay hidden">
            <div class="modal">
                <div class="modal-header">
                    <div class="modal-title">üéÆ –í—ã–±–æ—Ä —É—Ä–æ–≤–Ω—è —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ –ò–ò</div>
                    <button class="close-btn" onclick="closeModal('ai-modal')">√ó</button>
                </div>
                <div class="form-group">
                    <label class="form-label">–£—Ä–æ–≤–µ–Ω—å —Å–ª–æ–∂–Ω–æ—Å—Ç–∏:</label>
                    <select id="ai-level-select" class="form-select">
                        <option value="easy">üü¢ –õ–µ–≥–∫–∏–π (—Å–ª—É—á–∞–π–Ω—ã–µ —Ö–æ–¥—ã)</option>
                        <option value="medium" selected>üü° –°—Ä–µ–¥–Ω–∏–π (–±–∞–∑–æ–≤–∞—è —Å—Ç—Ä–∞—Ç–µ–≥–∏—è)</option>
                        <option value="hard">üî¥ –°–ª–æ–∂–Ω—ã–π (–ø—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–π –∞–ª–≥–æ—Ä–∏—Ç–º)</option>
                    </select>
                </div>
                <div class="btn-group">
                    <button class="btn btn-success" onclick="startAIGame()">–ù–∞—á–∞—Ç—å –∏–≥—Ä—É</button>
                    <button class="btn" onclick="closeModal('ai-modal')">–û—Ç–º–µ–Ω–∞</button>
                </div>
            </div>
        </div>

        <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –º—É–ª—å—Ç–∏–ø–ª–µ–µ—Ä–∞ -->
        <div id="multiplayer-modal" class="modal-overlay hidden">
            <div class="modal">
                <div class="modal-header">
                    <div class="modal-title">üë• –ú—É–ª—å—Ç–∏–ø–ª–µ–µ—Ä</div>
                    <button class="close-btn" onclick="closeModal('multiplayer-modal')">√ó</button>
                </div>
                
                <div class="btn-group" style="justify-content: center;">
                    <button class="btn btn-success" onclick="showCreateLobby()">
                        üÜï –°–æ–∑–¥–∞—Ç—å –ª–æ–±–±–∏
                    </button>
                    <button class="btn" onclick="showLobbyList()">
                        üìã –°–ø–∏—Å–æ–∫ –ª–æ–±–±–∏
                    </button>
                    <button class="btn btn-warning" onclick="showDirectJoin()">
                        üîó –ü—Ä—è–º–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ
                    </button>
                </div>
                
                <!-- –°–æ–∑–¥–∞–Ω–∏–µ –ª–æ–±–±–∏ -->
                <div id="create-lobby-form" class="hidden">
                    <div class="form-group">
                        <label class="form-label">–ù–∞–∑–≤–∞–Ω–∏–µ –ª–æ–±–±–∏:</label>
                        <input type="text" id="lobby-name" class="form-input" 
                               placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –ª–æ–±–±–∏" maxlength="20">
                    </div>
                    <div class="form-group">
                        <label class="form-label">–ü–∞—Ä–æ–ª—å (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ):</label>
                        <input type="password" id="lobby-password" class="form-input" 
                               placeholder="–û—Å—Ç–∞–≤—å—Ç–µ –ø—É—Å—Ç—ã–º –¥–ª—è –æ—Ç–∫—Ä—ã—Ç–æ–≥–æ –ª–æ–±–±–∏">
                    </div>
                    <div class="form-group">
                        <label class="form-label">–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏–≥—Ä–æ–∫–æ–≤:</label>
                        <select id="lobby-max-players" class="form-select">
                            <option value="2" selected>2 –∏–≥—Ä–æ–∫–∞ (1 –Ω–∞ 1)</option>
                        </select>
                    </div>
                    <div class="checkbox-group">
                        <input type="checkbox" id="lobby-private" checked>
                        <label class="checkbox-label">–û—Ç–æ–±—Ä–∞–∂–∞—Ç—å –≤ —Å–ø–∏—Å–∫–µ –ª–æ–±–±–∏</label>
                    </div>
                    <div class="btn-group">
                        <button class="btn btn-success" onclick="createLobby()">–°–æ–∑–¥–∞—Ç—å –ª–æ–±–±–∏</button>
                        <button class="btn" onclick="showMultiplayerMenu()">–ù–∞–∑–∞–¥</button>
                    </div>
                </div>
                
                <!-- –°–ø–∏—Å–æ–∫ –ª–æ–±–±–∏ -->
                <div id="lobby-list-container" class="hidden">
                    <div class="form-group">
                        <div style="display: flex; gap: 10px; margin-bottom: 15px;">
                            <input type="text" id="lobby-search" class="form-input" 
                                   placeholder="–ü–æ–∏—Å–∫ –ª–æ–±–±–∏..." onkeyup="searchLobbies()">
                            <button class="btn" onclick="refreshLobbyList()">üîÑ</button>
                        </div>
                    </div>
                    
                    <div id="lobbies-loading" class="loading hidden">
                        <div class="spinner"></div>
                        <p>–ó–∞–≥—Ä—É–∑–∫–∞ —Å–ø–∏—Å–∫–∞ –ª–æ–±–±–∏...</p>
                    </div>
                    
                    <div id="lobbies-empty" class="hidden" style="text-align: center; padding: 40px; color: #BBDEFB;">
                        <p>üòî –ù–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –ª–æ–±–±–∏</p>
                        <button class="btn" onclick="showCreateLobby()">–°–æ–∑–¥–∞—Ç—å –ø–µ—Ä–≤–æ–µ –ª–æ–±–±–∏</button>
                    </div>
                    
                    <div id="lobby-list" class="lobby-list-container">
                        <div class="lobby-list" id="lobby-list-content">
                            <!-- –õ–æ–±–±–∏ –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–µ–Ω—ã –∑–¥–µ—Å—å -->
                        </div>
                    </div>
                    
                    <div class="btn-group">
                        <button id="join-lobby-btn" class="btn btn-success" disabled 
                                onclick="joinSelectedLobby()">–ü—Ä–∏—Å–æ–µ–¥–∏–Ω–∏—Ç—å—Å—è</button>
                        <button class="btn" onclick="showMultiplayerMenu()">–ù–∞–∑–∞–¥</button>
                    </div>
                </div>
                
                <!-- –ü—Ä—è–º–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ -->
                <div id="direct-join-form" class="hidden">
                    <div class="form-group">
                        <label class="form-label">ID –ª–æ–±–±–∏:</label>
                        <input type="text" id="direct-lobby-id" class="form-input" 
                               placeholder="–í–≤–µ–¥–∏—Ç–µ ID –ª–æ–±–±–∏">
                    </div>
                    <div class="form-group">
                        <label class="form-label">–ü–∞—Ä–æ–ª—å (–µ—Å–ª–∏ —Ç—Ä–µ–±—É–µ—Ç—Å—è):</label>
                        <input type="password" id="direct-password" class="form-input" 
                               placeholder="–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å –ª–æ–±–±–∏">
                    </div>
                    <div class="btn-group">
                        <button class="btn btn-success" onclick="joinDirectLobby()">–ü—Ä–∏—Å–æ–µ–¥–∏–Ω–∏—Ç—å—Å—è</button>
                        <button class="btn" onclick="showMultiplayerMenu()">–ù–∞–∑–∞–¥</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –≤–≤–æ–¥–∞ –ø–∞—Ä–æ–ª—è –¥–ª—è –ª–æ–±–±–∏ -->
        <div id="password-modal" class="modal-overlay hidden">
            <div class="modal">
                <div class="modal-header">
                    <div class="modal-title">üîí –í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å</div>
                    <button class="close-btn" onclick="closeModal('password-modal')">√ó</button>
                </div>
                <div class="form-group">
                    <label class="form-label">–ü–∞—Ä–æ–ª—å –¥–ª—è –ª–æ–±–±–∏ "<span id="password-lobby-name"></span>":</label>
                    <input type="password" id="lobby-access-password" class="form-input" 
                           placeholder="–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å" autofocus>
                </div>
                <div class="btn-group">
                    <button class="btn btn-success" onclick="joinLobbyWithPassword()">–í–æ–π—Ç–∏</button>
                    <button class="btn" onclick="closeModal('password-modal')">–û—Ç–º–µ–Ω–∞</button>
                </div>
            </div>
        </div>

        <!-- –≠–∫—Ä–∞–Ω –ª–æ–±–±–∏ (–æ–∂–∏–¥–∞–Ω–∏–µ –∏–≥—Ä–æ–∫–æ–≤) -->
        <div id="lobby-screen" class="game-screen hidden">
            <div class="game-info">
                <div class="info-item">
                    <div class="info-label">–õ–æ–±–±–∏</div>
                    <div id="lobby-title" class="info-value">–ù–∞–∑–≤–∞–Ω–∏–µ –ª–æ–±–±–∏</div>
                </div>
                <div class="info-item">
                    <div class="info-label">–°—Ç–∞—Ç—É—Å</div>
                    <div id="lobby-status" class="info-value">–û–∂–∏–¥–∞–Ω–∏–µ –∏–≥—Ä–æ–∫–æ–≤</div>
                </div>
                <div class="info-item">
                    <div class="info-label">–ò–≥—Ä–æ–∫–æ–≤</div>
                    <div id="lobby-players" class="info-value">1/2</div>
                </div>
                <div class="info-item">
                    <div class="info-label">ID –ª–æ–±–±–∏</div>
                    <div id="lobby-id-display" class="info-value" style="font-size: 18px;">0000</div>
                </div>
            </div>

            <!-- –°–ø–∏—Å–æ–∫ –∏–≥—Ä–æ–∫–æ–≤ –≤ –ª–æ–±–±–∏ -->
            <div style="margin: 20px 0;">
                <h3 style="color: var(--neon-green); margin-bottom: 10px;">üë• –ò–≥—Ä–æ–∫–∏ –≤ –ª–æ–±–±–∏:</h3>
                <div id="players-list" style="display: flex; flex-direction: column; gap: 10px;">
                    <!-- –ò–≥—Ä–æ–∫–∏ –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã –∑–¥–µ—Å—å -->
                </div>
            </div>

            <!-- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ª–æ–±–±–∏ -->
            <div class="controls" style="margin: 20px 0;">
                <button class="btn btn-success" id="ready-btn" onclick="toggleReady()">
                    ‚úÖ –ì–æ—Ç–æ–≤ –∫ –∏–≥—Ä–µ
                </button>
                <button class="btn" onclick="copyLobbyId()">
                    üìã –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å ID
                </button>
                <button class="btn btn-danger" onclick="leaveLobby()">
                    üö™ –ü–æ–∫–∏–Ω—É—Ç—å –ª–æ–±–±–∏
                </button>
            </div>

            <!-- –ß–∞—Ç –ª–æ–±–±–∏ -->
            <div class="chat-container">
                <div class="chat-messages" id="lobby-chat">
                    <div class="chat-message">
                        <span class="message-sender">–°–∏—Å—Ç–µ–º–∞:</span>
                        –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –ª–æ–±–±–∏!
                    </div>
                </div>
                <div class="chat-input-container">
                    <input type="text" class="chat-input" id="lobby-chat-input" 
                           placeholder="–í–≤–µ–¥–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ..." onkeypress="handleChatKeypress(event)">
                    <button class="chat-send" onclick="sendLobbyMessage()">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
                </div>
            </div>

            <div id="lobby-game-status" class="status">
                –û–∂–∏–¥–∞–π—Ç–µ –≤—Ç–æ—Ä–æ–≥–æ –∏–≥—Ä–æ–∫–∞...
            </div>
        </div>

        <!-- –≠–∫—Ä–∞–Ω –∏–≥—Ä—ã -->
        <div id="game-screen" class="game-screen hidden">
            <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± –∏–≥—Ä–µ -->
            <div class="game-info">
                <div class="info-item">
                    <div class="info-label">–†–µ–∂–∏–º</div>
                    <div id="game-mode-display" class="info-value">–ü—Ä–æ—Ç–∏–≤ –ò–ò</div>
                </div>
                <div class="info-item">
                    <div class="info-label">–•–æ–¥</div>
                    <div id="turn-indicator" class="info-value">–í–∞—à —Ö–æ–¥</div>
                </div>
                <div class="info-item">
                    <div class="info-label">–ü–æ–ø–∞–¥–∞–Ω–∏—è</div>
                    <div id="hits-count" class="info-value">0/0</div>
                </div>
                <div class="info-item">
                    <div class="info-label">–ö–æ—Ä–∞–±–ª–∏</div>
                    <div id="ships-count" class="info-value">10/10</div>
                </div>
            </div>

            <!-- –í–µ—Ä—Ñ—å –¥–ª—è —Ä–∞—Å—Å—Ç–∞–Ω–æ–≤–∫–∏ –∫–æ—Ä–∞–±–ª–µ–π -->
            <div id="ship-factory" class="ship-factory hidden">
                <h3 style="text-align: center; margin-bottom: 15px; color: var(--neon-yellow);">üö¢ –í–µ—Ä—Ñ—å –∫–æ—Ä–∞–±–ª–µ–π</h3>
                <div class="ship-types" id="ship-types-container">
                    <!-- –ö–Ω–æ–ø–∫–∏ –∫–æ—Ä–∞–±–ª–µ–π –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã –∑–¥–µ—Å—å -->
                </div>
                
                <div class="controls" style="margin: 15px 0;">
                    <button class="btn rotate-btn" onclick="rotateShip()">
                        üîÑ –ü–æ–≤–æ—Ä–æ—Ç (R)
                    </button>
                    <button class="btn clear-btn" onclick="clearShips()">
                        üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å
                    </button>
                    <button class="btn" onclick="randomPlacement()">
                        üé≤ –°–ª—É—á–∞–π–Ω–∞—è —Ä–∞—Å—Å—Ç–∞–Ω–æ–≤–∫–∞
                    </button>
                    <button id="start-game-btn" class="btn start-btn" onclick="startBattle()" disabled>
                        ‚öîÔ∏è –ù–∞—á–∞—Ç—å –±–∏—Ç–≤—É!
                    </button>
                </div>
            </div>

            <!-- –ò–≥—Ä–æ–≤—ã–µ –ø–æ–ª—è -->
            <div class="game-area">
                <!-- –ü–æ–ª–µ –∏–≥—Ä–æ–∫–∞ -->
                <div class="grid-container">
                    <div class="grid-title">üéØ –í–∞—à —Ñ–ª–æ—Ç</div>
                    <div id="player-grid" class="grid"></div>
                </div>
                
                <!-- –ü–æ–ª–µ –ø—Ä–æ—Ç–∏–≤–Ω–∏–∫–∞ -->
                <div class="grid-container">
                    <div class="grid-title">üéØ –§–ª–æ—Ç –ø—Ä–æ—Ç–∏–≤–Ω–∏–∫–∞</div>
                    <div id="enemy-grid" class="grid"></div>
                </div>
            </div>

            <!-- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏–≥—Ä–æ–π -->
            <div class="controls" style="margin: 20px 0;">
                <button class="btn" onclick="aiMakeMove()" id="ai-move-btn" disabled>
                    ü§ñ –•–æ–¥ –ò–ò
                </button>
                <button class="btn" id="surrender-btn" onclick="surrender()">
                    üè≥Ô∏è –°–¥–∞—Ç—å—Å—è
                </button>
                <button class="btn restart-btn" onclick="restartGame()">
                    üîÑ –ù–æ–≤–∞—è –∏–≥—Ä–∞
                </button>
                <button class="btn" onclick="toggleSound()" id="sound-btn">
                    üîä –ó–≤—É–∫: –í–∫–ª
                </button>
            </div>

            <!-- –ß–∞—Ç –∏–≥—Ä—ã -->
            <div class="chat-container" id="game-chat-container">
                <div class="chat-messages" id="game-chat">
                    <div class="chat-message">
                        <span class="message-sender">–°–∏—Å—Ç–µ–º–∞:</span>
                        –ò–≥—Ä–∞ –Ω–∞—á–∞–ª–∞—Å—å!
                    </div>
                </div>
                <div class="chat-input-container">
                    <input type="text" class="chat-input" id="game-chat-input" 
                           placeholder="–í–≤–µ–¥–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ..." onkeypress="handleGameChatKeypress(event)">
                    <button class="chat-send" onclick="sendGameMessage()">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
                </div>
            </div>

            <!-- –°—Ç–∞—Ç—É—Å –∏–≥—Ä—ã -->
            <div id="game-status" class="status">
                –†–∞—Å—Å—Ç–∞–≤—å—Ç–µ –≤–∞—à–∏ –∫–æ—Ä–∞–±–ª–∏ –Ω–∞ –ø–æ–ª–µ
            </div>
        </div>

        <!-- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è -->
        <div id="notification-container"></div>
    </div>

    <!-- –ê—É–¥–∏–æ —ç–ª–µ–º–µ–Ω—Ç—ã -->
    <audio id="hit-sound" preload="auto">
        <source src="https://assets.mixkit.co/sfx/preview/mixkit-explosion-hit-1994.mp3" type="audio/mpeg">
    </audio>
    <audio id="miss-sound" preload="auto">
        <source src="https://assets.mixkit.co/sfx/preview/mixkit-water-splash-2005.mp3" type="audio/mpeg">
    </audio>
    <audio id="ship-sound" preload="auto">
        <source src="https://assets.mixkit.co/sfx/preview/mixkit-ship-horn-1211.mp3" type="audio/mpeg">
    </audio>
    <audio id="win-sound" preload="auto">
        <source src="https://assets.mixkit.co/sfx/preview/mixkit-winning-chimes-2015.mp3" type="audio/mpeg">
    </audio>
    <audio id="lose-sound" preload="auto">
        <source src="https://assets.mixkit.co/sfx/preview/mixkit-losing-bleeps-2026.mp3" type="audio/mpeg">
    </audio>
    <audio id="notification-sound" preload="auto">
        <source src="https://assets.mixkit.co/sfx/preview/mixkit-correct-answer-tone-2870.mp3" type="audio/mpeg">
    </audio>

    <script>
        // ==================== –ì–õ–û–ë–ê–õ–¨–ù–´–ï –ü–ï–†–ï–ú–ï–ù–ù–´–ï ====================
        let gameMode = null; // 'ai' –∏–ª–∏ 'multiplayer'
        let aiLevel = 'medium';
        let gameActive = false;
        let placementPhase = true;
        let currentShipSize = 4;
        let isVertical = false;
        let playerTurn = true;
        
        // –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
        let movesCount = 0;
        let playerHits = 0;
        let playerShots = 0;
        let aiHits = 0;
        let aiShots = 0;
        
        // –õ–∏–º–∏—Ç—ã –∫–æ—Ä–∞–±–ª–µ–π
        const shipLimits = { 4: 1, 3: 2, 2: 3, 1: 4 };
        const placedShips = { 4: 0, 3: 0, 2: 0, 1: 0 };
        
        // –ò–≥—Ä–æ–≤—ã–µ –ø–æ–ª—è
        let playerGrid = Array(100).fill(null);
        let enemyGrid = Array(100).fill(null);
        let playerShips = new Map();
        let enemyShips = new Map();
        
        // –î–ª—è –º—É–ª—å—Ç–∏–ø–ª–µ–µ—Ä–∞
        let socket = null;
        let currentLobby = null;
        let playerName = `–ò–≥—Ä–æ–∫_${Math.floor(Math.random() * 1000)}`;
        let isReady = false;
        let opponentReady = false;
        
        // –î–ª—è –ò–ò
        let aiMemory = {
            lastHit: null,
            hitDirection: null,
            huntMode: false,
            priorityTargets: [],
            triedCells: new Set(),
            probabilityMap: Array(100).fill(0)
        };
        
        // –ù–∞—Å—Ç—Ä–æ–π–∫–∏
        let soundEnabled = true;
        let notificationsEnabled = true;
        
        // DOM —ç–ª–µ–º–µ–Ω—Ç—ã
        const playerGridEl = document.getElementById('player-grid');
        const enemyGridEl = document.getElementById('enemy-grid');
        const gameStatus = document.getElementById('game-status');
        const notificationContainer = document.getElementById('notification-container');
        
        // ==================== –£–ü–†–ê–í–õ–ï–ù–ò–ï –ò–ù–¢–ï–†–§–ï–ô–°–û–ú ====================
        
        function selectGameMode(mode) {
            gameMode = mode;
            
            if (mode === 'ai') {
                showModal('ai-modal');
            } else if (mode === 'multiplayer') {
                showModal('multiplayer-modal');
                initMultiplayer();
            }
        }
        
        function showModal(modalId) {
            document.getElementById(modalId).classList.remove('hidden');
        }
        
        function closeModal(modalId) {
            document.getElementById(modalId).classList.add('hidden');
        }
        
        function showMultiplayerMenu() {
            document.getElementById('create-lobby-form').classList.add('hidden');
            document.getElementById('lobby-list-container').classList.add('hidden');
            document.getElementById('direct-join-form').classList.add('hidden');
        }
        
        function showCreateLobby() {
            showMultiplayerMenu();
            document.getElementById('create-lobby-form').classList.remove('hidden');
        }
        
        function showLobbyList() {
            showMultiplayerMenu();
            document.getElementById('lobby-list-container').classList.remove('hidden');
            loadLobbyList();
        }
        
        function showDirectJoin() {
            showMultiplayerMenu();
            document.getElementById('direct-join-form').classList.remove('hidden');
        }
        
        // ==================== –£–í–ï–î–û–ú–õ–ï–ù–ò–Ø ====================
        
        function showNotification(message, type = 'info') {
            if (!notificationsEnabled) return;
            
            const notification = document.createElement('div');
            notification.className = `notification notification-${type}`;
            notification.innerHTML = message;
            
            notificationContainer.appendChild(notification);
            
            if (soundEnabled) {
                playSound('notification-sound');
            }
            
            // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ 5 —Å–µ–∫—É–Ω–¥
            setTimeout(() => {
                notification.style.animation = 'slide-in 0.3s ease-out reverse';
                setTimeout(() => {
                    if (notification.parentNode) {
                        notification.parentNode.removeChild(notification);
                    }
                }, 300);
            }, 5000);
        }
        
        // ==================== –ú–£–õ–¨–¢–ò–ü–õ–ï–ï–† ====================
        
        function initMultiplayer() {
            if (socket) {
                socket.disconnect();
            }
            
            // –ü–æ–¥–∫–ª—é—á–∞–µ–º—Å—è –∫ —Å–µ—Ä–≤–µ—Ä—É WebSocket
            socket = io();
            
            // –°–æ–±—ã—Ç–∏—è —Å–µ—Ä–≤–µ—Ä–∞
            socket.on('connect', () => {
                console.log('–ü–æ–¥–∫–ª—é—á–µ–Ω –∫ —Å–µ—Ä–≤–µ—Ä—É');
                showNotification('‚úÖ –ü–æ–¥–∫–ª—é—á–µ–Ω–æ –∫ —Å–µ—Ä–≤–µ—Ä—É', 'success');
            });
            
            socket.on('disconnect', () => {
                console.log('–û—Ç–∫–ª—é—á–µ–Ω –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞');
                showNotification('‚ùå –û—Ç–∫–ª—é—á–µ–Ω–æ –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞', 'error');
            });
            
            socket.on('lobbyCreated', (data) => {
                console.log('–õ–æ–±–±–∏ —Å–æ–∑–¥–∞–Ω–æ:', data);
                currentLobby = data;
                showLobbyScreen();
            });
            
            socket.on('lobbyList', (lobbies) => {
                updateLobbyList(lobbies);
            });
            
            socket.on('lobbyJoined', (data) => {
                console.log('–ü—Ä–∏—Å–æ–µ–¥–∏–Ω–∏–ª—Å—è –∫ –ª–æ–±–±–∏:', data);
                currentLobby = data;
                showLobbyScreen();
            });
            
            socket.on('lobbyError', (error) => {
                showNotification(`‚ùå ${error}`, 'error');
            });
            
            socket.on('playerJoined', (player) => {
                console.log('–ò–≥—Ä–æ–∫ –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–∏–ª—Å—è:', player);
                showNotification(`üë§ ${player.name} –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–∏–ª—Å—è –∫ –ª–æ–±–±–∏`, 'success');
                updatePlayersList();
            });
            
            socket.on('playerLeft', (player) => {
                console.log('–ò–≥—Ä–æ–∫ –ø–æ–∫–∏–Ω—É–ª:', player);
                showNotification(`üë§ ${player.name} –ø–æ–∫–∏–Ω—É–ª –ª–æ–±–±–∏`, 'warning');
                updatePlayersList();
            });
            
            socket.on('playerReady', (data) => {
                console.log('–ò–≥—Ä–æ–∫ –≥–æ—Ç–æ–≤:', data);
                if (data.playerId !== socket.id) {
                    opponentReady = data.ready;
                    showNotification(`üë§ ${data.playerName} ${data.ready ? '–≥–æ—Ç–æ–≤' : '–Ω–µ –≥–æ—Ç–æ–≤'}`, 'info');
                    updatePlayersList();
                }
            });
            
            socket.on('lobbyMessage', (message) => {
                addLobbyChatMessage(message.sender, message.text);
            });
            
            socket.on('gameStart', (data) => {
                console.log('–ò–≥—Ä–∞ –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è:', data);
                startMultiplayerGame(data);
            });
            
            socket.on('enemyMove', (data) => {
                console.log('–•–æ–¥ –ø—Ä–æ—Ç–∏–≤–Ω–∏–∫–∞:', data);
                handleEnemyMove(data);
            });
            
            socket.on('shotResult', (data) => {
                console.log('–†–µ–∑—É–ª—å—Ç–∞—Ç –≤—ã—Å—Ç—Ä–µ–ª–∞:', data);
                handleShotResult(data);
            });
            
            socket.on('gameOver', (data) => {
                console.log('–ò–≥—Ä–∞ –æ–∫–æ–Ω—á–µ–Ω–∞:', data);
                endGame(data.winner === socket.id);
            });
            
            socket.on('gameMessage', (message) => {
                addGameChatMessage(message.sender, message.text);
            });
        }
        
        function createLobby() {
            const name = document.getElementById('lobby-name').value.trim();
            const password = document.getElementById('lobby-password').value;
            const maxPlayers = document.getElementById('lobby-max-players').value;
            const isPrivate = !document.getElementById('lobby-private').checked;
            
            if (!name) {
                showNotification('‚ùå –í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –ª–æ–±–±–∏', 'error');
                return;
            }
            
            socket.emit('createLobby', {
                name: name,
                password: password || null,
                maxPlayers: parseInt(maxPlayers),
                isPrivate: isPrivate,
                playerName: playerName
            });
        }
        
        function loadLobbyList() {
            document.getElementById('lobbies-loading').classList.remove('hidden');
            document.getElementById('lobbies-empty').classList.add('hidden');
            document.getElementById('lobby-list-content').innerHTML = '';
            
            socket.emit('getLobbies');
        }
        
        function refreshLobbyList() {
            loadLobbyList();
            showNotification('üîÑ –°–ø–∏—Å–æ–∫ –ª–æ–±–±–∏ –æ–±–Ω–æ–≤–ª–µ–Ω', 'info');
        }
        
        function updateLobbyList(lobbies) {
            document.getElementById('lobbies-loading').classList.add('hidden');
            
            const lobbyListContent = document.getElementById('lobby-list-content');
            lobbyListContent.innerHTML = '';
            
            if (lobbies.length === 0) {
                document.getElementById('lobbies-empty').classList.remove('hidden');
                return;
            }
            
            lobbies.forEach(lobby => {
                const lobbyItem = document.createElement('div');
                lobbyItem.className = 'lobby-item';
                lobbyItem.dataset.lobbyId = lobby.id;
                lobbyItem.onclick = () => selectLobby(lobby.id);
                
                let statusClass = 'status-waiting';
                let statusText = '–û–∂–∏–¥–∞–Ω–∏–µ';
                
                if (lobby.players.length >= lobby.maxPlayers) {
                    statusClass = 'status-full';
                    statusText = '–ó–∞–ø–æ–ª–Ω–µ–Ω–æ';
                } else if (lobby.gameStarted) {
                    statusClass = 'status-playing';
                    statusText = '–í –∏–≥—Ä–µ';
                }
                
                lobbyItem.innerHTML = `
                    <div class="lobby-info">
                        <div class="lobby-name">${lobby.name}</div>
                        <div class="lobby-meta">
                            <span>üë• ${lobby.players.length}/${lobby.maxPlayers}</span>
                            <span>‚öîÔ∏è ${lobby.mode || '–ö–ª–∞—Å—Å–∏–∫–∞'}</span>
                            ${lobby.hasPassword ? '<span class="password-badge">üîí</span>' : ''}
                        </div>
                    </div>
                    <div class="lobby-status ${statusClass}">${statusText}</div>
                `;
                
                lobbyListContent.appendChild(lobbyItem);
            });
        }
        
        function selectLobby(lobbyId) {
            // –£–±—Ä–∞—Ç—å –≤—ã–¥–µ–ª–µ–Ω–∏–µ —Å–æ –≤—Å–µ—Ö –ª–æ–±–±–∏
            document.querySelectorAll('.lobby-item').forEach(item => {
                item.classList.remove('selected');
            });
            
            // –í—ã–¥–µ–ª–∏—Ç—å –≤—ã–±—Ä–∞–Ω–Ω–æ–µ –ª–æ–±–±–∏
            const selectedItem = document.querySelector(`.lobby-item[data-lobby-id="${lobbyId}"]`);
            if (selectedItem) {
                selectedItem.classList.add('selected');
                document.getElementById('join-lobby-btn').disabled = false;
            }
        }
        
        function joinSelectedLobby() {
            const selectedItem = document.querySelector('.lobby-item.selected');
            if (!selectedItem) return;
            
            const lobbyId = selectedItem.dataset.lobbyId;
            joinLobby(lobbyId);
        }
        
        function joinLobby(lobbyId) {
            socket.emit('joinLobby', {
                lobbyId: lobbyId,
                playerName: playerName
            });
        }
        
        function joinDirectLobby() {
            const lobbyId = document.getElementById('direct-lobby-id').value.trim();
            const password = document.getElementById('direct-password').value;
            
            if (!lobbyId) {
                showNotification('‚ùå –í–≤–µ–¥–∏—Ç–µ ID –ª–æ–±–±–∏', 'error');
                return;
            }
            
            socket.emit('joinLobby', {
                lobbyId: lobbyId,
                password: password || null,
                playerName: playerName
            });
        }
        
        function showLobbyScreen() {
            document.getElementById('main-menu').classList.add('hidden');
            document.getElementById('multiplayer-modal').classList.add('hidden');
            document.getElementById('lobby-screen').classList.remove('hidden');
            
            document.getElementById('lobby-title').textContent = currentLobby.name;
            document.getElementById('lobby-id-display').textContent = currentLobby.id;
            document.getElementById('lobby-status').textContent = 
                currentLobby.players.length >= currentLobby.maxPlayers ? '–ó–∞–ø–æ–ª–Ω–µ–Ω–æ' : '–û–∂–∏–¥–∞–Ω–∏–µ –∏–≥—Ä–æ–∫–æ–≤';
            document.getElementById('lobby-players').textContent = 
                `${currentLobby.players.length}/${currentLobby.maxPlayers}`;
            
            updatePlayersList();
            
            // –°–±—Ä–æ—Å —Å–æ—Å—Ç–æ—è–Ω–∏—è –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏
            isReady = false;
            opponentReady = false;
            document.getElementById('ready-btn').textContent = '‚úÖ –ì–æ—Ç–æ–≤ –∫ –∏–≥—Ä–µ';
            document.getElementById('lobby-game-status').textContent = '–û–∂–∏–¥–∞–π—Ç–µ –≤—Ç–æ—Ä–æ–≥–æ –∏–≥—Ä–æ–∫–∞...';
        }
        
        function updatePlayersList() {
            const playersList = document.getElementById('players-list');
            playersList.innerHTML = '';
            
            if (!currentLobby || !currentLobby.players) return;
            
            currentLobby.players.forEach(player => {
                const playerDiv = document.createElement('div');
                playerDiv.className = 'player-item';
                playerDiv.style.cssText = `
                    background: rgba(255, 255, 255, 0.1);
                    padding: 10px 15px;
                    border-radius: 8px;
                    display: flex;
                    justify-content: space-between;
                    align-items: center;
                    border: 2px solid ${player.ready ? '#00E676' : '#536DFE'};
                `;
                
                playerDiv.innerHTML = `
                    <div>
                        <strong style="color: #FFEB3B;">${player.name}</strong>
                        ${player.id === socket.id ? ' (–í—ã)' : ''}
                    </div>
                    <div style="color: ${player.ready ? '#00E676' : '#536DFE'};">
                        ${player.ready ? '‚úÖ –ì–æ—Ç–æ–≤' : '‚è≥ –û–∂–∏–¥–∞–Ω–∏–µ'}
                    </div>
                `;
                
                playersList.appendChild(playerDiv);
            });
            
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—á–µ—Ç—á–∏–∫–∞ –∏–≥—Ä–æ–∫–æ–≤
            document.getElementById('lobby-players').textContent = 
                `${currentLobby.players.length}/${currentLobby.maxPlayers}`;
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞, –≤—Å–µ –ª–∏ –≥–æ—Ç–æ–≤—ã
            if (currentLobby.players.length === currentLobby.maxPlayers) {
                const allReady = currentLobby.players.every(p => p.ready);
                if (allReady) {
                    document.getElementById('lobby-game-status').textContent = 
                        '–í—Å–µ –∏–≥—Ä–æ–∫–∏ –≥–æ—Ç–æ–≤—ã! –ò–≥—Ä–∞ –Ω–∞—á–Ω–µ—Ç—Å—è —á–µ—Ä–µ–∑ 3 —Å–µ–∫—É–Ω–¥—ã...';
                    
                    // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Å—Ç–∞—Ä—Ç –∏–≥—Ä—ã —á–µ—Ä–µ–∑ 3 —Å–µ–∫—É–Ω–¥—ã
                    setTimeout(() => {
                        if (currentLobby && currentLobby.players.every(p => p.ready)) {
                            socket.emit('startGame');
                        }
                    }, 3000);
                }
            }
        }
        
        function toggleReady() {
            isReady = !isReady;
            socket.emit('setReady', isReady);
            document.getElementById('ready-btn').textContent = 
                isReady ? '‚ùå –û—Ç–º–µ–Ω–∏—Ç—å –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç—å' : '‚úÖ –ì–æ—Ç–æ–≤ –∫ –∏–≥—Ä–µ';
        }
        
        function copyLobbyId() {
            navigator.clipboard.writeText(currentLobby.id).then(() => {
                showNotification('üìã ID –ª–æ–±–±–∏ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞', 'success');
            });
        }
        
        function leaveLobby() {
            socket.emit('leaveLobby');
            currentLobby = null;
            document.getElementById('lobby-screen').classList.add('hidden');
            document.getElementById('main-menu').classList.remove('hidden');
        }
        
        function addLobbyChatMessage(sender, text) {
            const chat = document.getElementById('lobby-chat');
            const message = document.createElement('div');
            message.className = 'chat-message';
            message.innerHTML = `<span class="message-sender">${sender}:</span> ${text}`;
            chat.appendChild(message);
            chat.scrollTop = chat.scrollHeight;
        }
        
        function sendLobbyMessage() {
            const input = document.getElementById('lobby-chat-input');
            const text = input.value.trim();
            
            if (text) {
                socket.emit('lobbyMessage', text);
                input.value = '';
            }
        }
        
        function handleChatKeypress(event) {
            if (event.key === 'Enter') {
                sendLobbyMessage();
            }
        }
        
        // ==================== –ò–ì–†–ê –ü–†–û–¢–ò–í –ò–ò ====================
        
        function startAIGame() {
            aiLevel = document.getElementById('ai-level-select').value;
            closeModal('ai-modal');
            document.getElementById('main-menu').classList.add('hidden');
            document.getElementById('game-screen').classList.remove('hidden');
            
            document.getElementById('game-mode-display').textContent = 
                `–ü—Ä–æ—Ç–∏–≤ –ò–ò (${aiLevel === 'easy' ? '–õ–µ–≥–∫–∏–π' : aiLevel === 'medium' ? '–°—Ä–µ–¥–Ω–∏–π' : '–°–ª–æ–∂–Ω—ã–π'})`;
            
            initGame();
        }
        
        // ==================== –û–ë–©–ê–Ø –õ–û–ì–ò–ö–ê –ò–ì–†–´ ====================
        
        function initGame() {
            createGrids();
            updateGameInfo();
            createShipButtons();
            selectShipSize(4);
            
            if (gameMode === 'ai') {
                generateAIShips();
                updateProbabilityMap();
            }
            
            setupKeyboardControls();
        }
        
        function createGrids() {
            playerGridEl.innerHTML = '';
            enemyGridEl.innerHTML = '';
            
            // –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—è –∏–≥—Ä–æ–∫–∞
            for (let i = 0; i < 100; i++) {
                const cell = document.createElement('div');
                cell.className = 'cell';
                cell.dataset.index = i;
                cell.id = `player-${i}`;
                
                if (placementPhase) {
                    cell.addEventListener('click', () => placePlayerShip(i));
                    cell.addEventListener('mouseenter', () => showShipPreview(i));
                    cell.addEventListener('mouseleave', () => hideShipPreview(i));
                }
                
                playerGridEl.appendChild(cell);
            }
            
            // –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—è –ø—Ä–æ—Ç–∏–≤–Ω–∏–∫–∞
            for (let i = 0; i < 100; i++) {
                const cell = document.createElement('div');
                cell.className = 'cell';
                cell.dataset.index = i;
                cell.id = `enemy-${i}`;
                
                if (!placementPhase && playerTurn) {
                    cell.addEventListener('click', () => attackEnemy(i));
                }
                
                enemyGridEl.appendChild(cell);
            }
        }
        
        function createShipButtons() {
            const container = document.getElementById('ship-types-container');
            container.innerHTML = '';
            
            for (let size = 4; size >= 1; size--) {
                const button = document.createElement('button');
                button.className = 'ship-type-btn';
                button.id = `ship-btn-${size}`;
                button.onclick = () => selectShipSize(size);
                
                const remaining = shipLimits[size] - placedShips[size];
                button.innerHTML = `
                    <div style="display: flex; align-items: center; gap: 10px;">
                        <div style="width: ${size * 20}px; height: 20px; background: #4CAF50; border-radius: 3px;"></div>
                        <span>${size}-–ø–∞–ª—É–±–Ω—ã–π (${remaining}/${shipLimits[size]})</span>
                    </div>
                `;
                
                if (remaining === 0) {
                    button.disabled = true;
                    button.style.opacity = '0.6';
                }
                
                container.appendChild(button);
            }
            
            // –í—ã–¥–µ–ª–∏—Ç—å –ø–µ—Ä–≤—ã–π –∫–æ—Ä–∞–±–ª—å
            selectShipSize(4);
        }
        
        function selectShipSize(size) {
            currentShipSize = size;
            
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ UI
            document.querySelectorAll('.ship-type-btn').forEach(btn => {
                btn.style.background = '';
                btn.style.borderColor = '';
            });
            
            const btn = document.getElementById(`ship-btn-${size}`);
            if (btn) {
                btn.style.background = 'rgba(0, 176, 255, 0.2)';
                btn.style.borderColor = 'var(--neon-blue)';
            }
        }
        
        // ... (–æ—Å—Ç–∞–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –∏–∑ –ø—Ä–µ–¥—ã–¥—É—â–µ–π –≤–µ—Ä—Å–∏–∏: rotateShip, showShipPreview, hideShipPreview, 
        // getShipCoordinates, canPlaceShip, placePlayerShip, clearShips, randomPlacement, renderPlayerShips,
        // generateAIShips, canPlaceAIShip, startBattle, attackEnemy, aiMakeMove, –∏ —Ç.–¥.)
        // –≠—Ç–∏ —Ñ—É–Ω–∫—Ü–∏–∏ –æ—Å—Ç–∞—é—Ç—Å—è —Ç–∞–∫–∏–º–∏ –∂–µ, –∫–∞–∫ –≤ –ø—Ä–µ–¥—ã–¥—É—â–µ–π –≤–µ—Ä—Å–∏–∏
        
        // ==================== –ú–£–õ–¨–¢–ò–ü–õ–ï–ï–† –ò–ì–†–ê ====================
        
        function startMultiplayerGame(data) {
            gameMode = 'multiplayer';
            document.getElementById('lobby-screen').classList.add('hidden');
            document.getElementById('game-screen').classList.remove('hidden');
            document.getElementById('ship-factory').classList.remove('hidden');
            document.getElementById('game-chat-container').classList.remove('hidden');
            
            document.getElementById('game-mode-display').textContent = '–ü—Ä–æ—Ç–∏–≤ –∏–≥—Ä–æ–∫–∞';
            document.getElementById('turn-indicator').textContent = data.canMove ? '–í–∞—à —Ö–æ–¥' : '–•–æ–¥ –ø—Ä–æ—Ç–∏–≤–Ω–∏–∫–∞';
            
            playerTurn = data.canMove;
            gameActive = true;
            placementPhase = true;
            
            initGame();
        }
        
        function handleEnemyMove(data) {
            const index = data.index;
            const cell = document.getElementById(`player-${index}`);
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–ø–∞–¥–∞–Ω–∏—è
            const shipId = playerGrid[index];
            if (shipId) {
                // –ü–æ–ø–∞–¥–∞–Ω–∏–µ
                cell.classList.add('hit');
                const ship = playerShips.get(shipId);
                ship.health--;
                
                // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
                socket.emit('shotResult', {
                    index: index,
                    hit: true,
                    killed: ship.health === 0,
                    coords: ship.health === 0 ? ship.cells : null
                });
                
                if (ship.health === 0) {
                    markAroundShip(ship.cells, 'player');
                }
                
                // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Ä–∞–∂–µ–Ω–∏—è
                if (checkPlayerDefeat()) {
                    socket.emit('gameOver');
                }
            } else {
                // –ü—Ä–æ–º–∞—Ö
                cell.classList.add('miss');
                socket.emit('shotResult', {
                    index: index,
                    hit: false,
                    killed: false
                });
                playerTurn = true;
                document.getElementById('turn-indicator').textContent = '–í–∞—à —Ö–æ–¥';
            }
            
            updateGameInfo();
        }
        
        function handleShotResult(data) {
            const cell = document.getElementById(`enemy-${data.index}`);
            
            if (data.hit) {
                cell.classList.add('hit');
                playerTurn = true;
                document.getElementById('turn-indicator').textContent = '–í–∞—à —Ö–æ–¥';
                
                if (data.killed) {
                    markAroundShip(data.coords, 'enemy');
                }
            } else {
                cell.classList.add('miss');
                playerTurn = false;
                document.getElementById('turn-indicator').textContent = '–•–æ–¥ –ø—Ä–æ—Ç–∏–≤–Ω–∏–∫–∞';
            }
            
            updateGameInfo();
        }
        
        function attackEnemy(index) {
            if (gameMode === 'multiplayer') {
                if (!playerTurn || !gameActive) return;
                
                const cell = document.getElementById(`enemy-${index}`);
                if (cell.classList.contains('hit') || cell.classList.contains('miss')) return;
                
                socket.emit('makeMove', { index: index });
                playerTurn = false;
                document.getElementById('turn-indicator').textContent = '–•–æ–¥ –ø—Ä–æ—Ç–∏–≤–Ω–∏–∫–∞';
            } else {
                // –õ–æ–≥–∏–∫–∞ –¥–ª—è –ò–ò (–∫–∞–∫ –≤ –ø—Ä–µ–¥—ã–¥—É—â–µ–π –≤–µ—Ä—Å–∏–∏)
            }
        }
        
        function addGameChatMessage(sender, text) {
            const chat = document.getElementById('game-chat');
            const message = document.createElement('div');
            message.className = 'chat-message';
            message.innerHTML = `<span class="message-sender">${sender}:</span> ${text}`;
            chat.appendChild(message);
            chat.scrollTop = chat.scrollHeight;
        }
        
        function sendGameMessage() {
            const input = document.getElementById('game-chat-input');
            const text = input.value.trim();
            
            if (text) {
                socket.emit('gameMessage', text);
                input.value = '';
            }
        }
        
        function handleGameChatKeypress(event) {
            if (event.key === 'Enter') {
                sendGameMessage();
            }
        }
        
        function surrender() {
            if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —Å–¥–∞—Ç—å—Å—è?')) {
                if (gameMode === 'multiplayer') {
                    socket.emit('gameOver');
                }
                endGame(false);
            }
        }
        
        // ==================== –í–°–ü–û–ú–û–ì–ê–¢–ï–õ–¨–ù–´–ï –§–£–ù–ö–¶–ò–ò ====================
        
        function updateGameInfo() {
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—á–µ—Ç—á–∏–∫–æ–≤
            document.getElementById('hits-count').textContent = `${playerHits}/${playerShots}`;
            
            let playerShipsLeft = 0;
            let enemyShipsLeft = 0;
            
            for (const ship of playerShips.values()) {
                if (ship.health > 0) playerShipsLeft++;
            }
            
            for (const ship of enemyShips.values()) {
                if (ship.health > 0) enemyShipsLeft++;
            }
            
            document.getElementById('ships-count').textContent = `${playerShipsLeft}/${enemyShipsLeft}`;
        }
        
        function playSound(soundId) {
            if (!soundEnabled) return;
            
            const sound = document.getElementById(soundId);
            if (sound) {
                sound.currentTime = 0;
                sound.play().catch(e => console.log('–ê—É–¥–∏–æ –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–æ:', e));
            }
        }
        
        function toggleSound() {
            soundEnabled = !soundEnabled;
            const btn = document.getElementById('sound-btn');
            btn.textContent = soundEnabled ? 'üîä –ó–≤—É–∫: –í–∫–ª' : 'üîá –ó–≤—É–∫: –í—ã–∫–ª';
        }
        
        function restartGame() {
            if (gameMode === 'multiplayer' && gameActive) {
                if (!confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã? –≠—Ç–æ –∑–∞–≤–µ—Ä—à–∏—Ç —Ç–µ–∫—É—â—É—é –∏–≥—Ä—É.')) return;
                socket.emit('leaveGame');
            }
            
            location.reload();
        }
        
        function showStats() {
            alert('–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–∞ –≤ —Å–ª–µ–¥—É—é—â–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏!');
        }
        
        // ==================== –ó–ê–ü–£–°–ö ====================
        
        window.addEventListener('DOMContentLoaded', () => {
            console.log('–ú–æ—Ä—Å–∫–æ–π –ë–æ–π –∑–∞–≥—Ä—É–∂–µ–Ω!');
            
            // –ó–∞–≥—Ä—É–∑–∫–∞ –∏–º–µ–Ω–∏ –∏–≥—Ä–æ–∫–∞
            const savedName = localStorage.getItem('playerName');
            if (savedName) {
                playerName = savedName;
            } else {
                localStorage.setItem('playerName', playerName);
            }
            
            // –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∑–≤—É–∫–∞
            const savedSound = localStorage.getItem('soundEnabled');
            if (savedSound !== null) {
                soundEnabled = savedSound === 'true';
                document.getElementById('sound-btn').textContent = 
                    soundEnabled ? 'üîä –ó–≤—É–∫: –í–∫–ª' : 'üîá –ó–≤—É–∫: –í—ã–∫–ª';
            }
        });
        
        // –≠–∫—Å–ø–æ—Ä—Ç —Ñ—É–Ω–∫—Ü–∏–π –¥–ª—è HTML
        window.selectGameMode = selectGameMode;
        window.closeModal = closeModal;
        window.showCreateLobby = showCreateLobby;
        window.showLobbyList = showLobbyList;
        window.showDirectJoin = showDirectJoin;
        window.showMultiplayerMenu = showMultiplayerMenu;
        window.createLobby = createLobby;
        window.refreshLobbyList = refreshLobbyList;
        window.joinSelectedLobby = joinSelectedLobby;
        window.joinDirectLobby = joinDirectLobby;
        window.toggleReady = toggleReady;
        window.copyLobbyId = copyLobbyId;
        window.leaveLobby = leaveLobby;
        window.sendLobbyMessage = sendLobbyMessage;
        window.handleChatKeypress = handleChatKeypress;
        window.startAIGame = startAIGame;
        // ... –æ—Å—Ç–∞–ª—å–Ω—ã–µ —ç–∫—Å–ø–æ—Ä—Ç—ã
    </script>
</body>
</html>
